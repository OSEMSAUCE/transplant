import{c as $e,a as ie,b as q,l as Ke,t as le,f as Ae,e as ot}from"../chunks/klTIG8DC.js";import{a8 as qt,aA as Ht,aB as ir,aC as lr,aD as dr,U as Ft,v as gt,k as ke,ab as ur,al as fr,q as cr,g as mr,D as r,C as pr,t as hr,u as Tt,w as vt,l as nt,ae as gr,x as Wt,h as Bt,y as vr,aj as Zt,K as _r,aE as Rt,aF as _t,a4 as kt,aG as xt,aH as At,aI as yr,ah as br,aJ as Nr,j as Cr,aK as St,aL as wr,a6 as xr,ac as Sr,aM as $t,aN as Ir,aO as Er,aP as Fr,aQ as Tr,aR as Rr,aS as kr,aT as Ar,aU as Ot,M as Kt,au as Or,at as Qt,aV as Dr,S as Mr,aW as Lr,p as Qe,ax as Ne,I as Je,aw as Pr,c as X,a as Ye,J as B,s as ce,F as te,aX as s,aY as dt,r as V,a0 as pe,az as he,f as ze,aZ as it,n as jr,ay as Ur}from"../chunks/CKbmgweX.js";import{b as zr,l as Yt,d as et,e as ye,s as Se,c as Te}from"../chunks/CEnzLGfm.js";import{i as ge,p as Be}from"../chunks/CV8Dz3o8.js";var Jr="font-weight: bold",Vr="font-weight: normal";function Dt(e){console.warn(`%c[svelte] state_snapshot_uncloneable
%c${e?`The following properties cannot be cloned with \`$state.snapshot\` — the return value contains the originals:

${e}`:"Value cannot be cloned with `$state.snapshot` — the original value was returned"}
https://svelte.dev/e/state_snapshot_uncloneable`,Jr,Vr)}const Gr=[];function Xt(e,t=!1){if(!t){const n=[],a=at(e,new Map,"",n);if(n.length===1&&n[0]==="")Dt();else if(n.length>0){const l=n.length>10?n.slice(0,7):n.slice(0,10),u=n.length-l.length;let d=l.map(p=>`- <value>${p}`).join(`
`);u>0&&(d+=`
- ...and ${u} more`),Dt(d)}return a}return at(e,new Map,"",Gr)}function at(e,t,n,a,l=null){if(typeof e=="object"&&e!==null){var u=t.get(e);if(u!==void 0)return u;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(qt(e)){var d=Array(e.length);t.set(e,d),l!==null&&t.set(l,d);for(var p=0;p<e.length;p+=1){var b=e[p];p in e&&(d[p]=at(b,t,`${n}[${p}]`,a))}return d}if(Ht(e)===ir){d={},t.set(e,d),l!==null&&t.set(l,d);for(var h in e)d[h]=at(e[h],t,`${n}.${h}`,a);return d}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function")return at(e.toJSON(),t,`${n}.toJSON()`,a,e)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return a.push(n),e}}function qr(e,t=console.log){lr("$inspect");let n=!0;dr(()=>{var a=Ft;try{a=e()}catch(l){console.error(l)}a!==Ft&&t(n?"init":"update",...Xt(a,!0)),n=!1})}function we(e,t){return t}function Hr(e,t,n,a){for(var l=[],u=t.length,d=0;d<u;d++)yr(t[d].e,l,!0);var p=u>0&&l.length===0&&n!==null;if(p){var b=n.parentNode;br(b),b.append(n),a.clear(),qe(e,t[0].prev,t[u-1].next)}Nr(l,()=>{for(var h=0;h<u;h++){var g=t[h];p||(a.delete(g.k),qe(e,g.prev,g.next)),Cr(g.e,!p)}})}function xe(e,t,n,a,l,u=null){var d=e,p={flags:t,items:new Map,first:null},b=(t&$t)!==0;if(b){var h=e;d=ke?gt(ur(h)):h.appendChild(fr())}ke&&cr();var g=null,M=!1,D=pr(()=>{var J=n();return qt(J)?J:J==null?[]:Zt(J)});mr(()=>{var J=r(D),_=J.length;if(M&&_===0)return;M=_===0;let y=!1;if(ke){var v=d.data===hr;v!==(_===0)&&(d=Tt(),gt(d),vt(!1),y=!0)}if(ke){for(var E=null,H,Y=0;Y<_;Y++){if(nt.nodeType===8&&nt.data===gr){d=nt,y=!0,vt(!1);break}var O=J[Y],K=a(O,Y);H=er(nt,p,E,null,O,K,Y,l,t,n),p.items.set(K,H),E=H}_>0&&gt(Tt())}ke||Wr(J,p,d,l,t,a,n),u!==null&&(_===0?g?Wt(g):g=Bt(()=>u(d)):g!==null&&vr(g,()=>{g=null})),y&&vt(!0),r(D)}),ke&&(d=nt)}function Wr(e,t,n,a,l,u,d){var re,U,ne,$;var p=(l&Ir)!==0,b=(l&(St|xt))!==0,h=e.length,g=t.items,M=t.first,D=M,J,_=null,y,v=[],E=[],H,Y,O,K;if(p)for(K=0;K<h;K+=1)H=e[K],Y=u(H,K),O=g.get(Y),O!==void 0&&((re=O.a)==null||re.measure(),(y??(y=new Set)).add(O));for(K=0;K<h;K+=1){if(H=e[K],Y=u(H,K),O=g.get(Y),O===void 0){var fe=D?D.e.nodes_start:n;_=er(fe,t,_,_===null?t.first:_.next,H,Y,K,a,l,d),g.set(Y,_),v=[],E=[],D=_.next;continue}if(b&&Br(O,H,K,l),(O.e.f&_t)!==0&&(Wt(O.e),p&&((U=O.a)==null||U.unfix(),(y??(y=new Set)).delete(O))),O!==D){if(J!==void 0&&J.has(O)){if(v.length<E.length){var L=E[0],o;_=L.prev;var i=v[0],m=v[v.length-1];for(o=0;o<v.length;o+=1)Mt(v[o],L,n);for(o=0;o<E.length;o+=1)J.delete(E[o]);qe(t,i.prev,m.next),qe(t,_,i),qe(t,m,L),D=L,_=m,K-=1,v=[],E=[]}else J.delete(O),Mt(O,D,n),qe(t,O.prev,O.next),qe(t,O,_===null?t.first:_.next),qe(t,_,O),_=O;continue}for(v=[],E=[];D!==null&&D.k!==Y;)(D.e.f&_t)===0&&(J??(J=new Set)).add(D),E.push(D),D=D.next;if(D===null)continue;O=D}v.push(O),_=O,D=O.next}if(D!==null||J!==void 0){for(var x=J===void 0?[]:Zt(J);D!==null;)(D.e.f&_t)===0&&x.push(D),D=D.next;var S=x.length;if(S>0){var w=(l&$t)!==0&&h===0?n:null;if(p){for(K=0;K<S;K+=1)(ne=x[K].a)==null||ne.measure();for(K=0;K<S;K+=1)($=x[K].a)==null||$.fix()}Hr(t,x,w,g)}}p&&xr(()=>{var de;if(y!==void 0)for(O of y)(de=O.a)==null||de.apply()}),kt.first=t.first&&t.first.e,kt.last=_&&_.e}function Br(e,t,n,a){(a&St)!==0&&At(e.v,t),(a&xt)!==0?At(e.i,n):e.i=n}function er(e,t,n,a,l,u,d,p,b,h){var g=(b&St)!==0,M=(b&wr)===0,D=g?M?_r(l):Rt(l):l,J=(b&xt)===0?d:Rt(d);g&&(D.debug=()=>{var y=typeof J=="number"?d:J.v;h()[y]});var _={i:J,v:D,k:u,a:null,e:null,prev:n,next:a};try{return _.e=Bt(()=>p(e,D,J,h),ke),_.e.prev=n&&n.e,_.e.next=a&&a.e,n===null?t.first=_:(n.next=_,n.e.next=_.e),a!==null&&(a.prev=_,a.e.prev=_.e),_}finally{}}function Mt(e,t,n){for(var a=e.next?e.next.e.nodes_start:n,l=t?t.e.nodes_start:n,u=e.e.nodes_start;u!==a;){var d=Sr(u);l.before(u),u=d}}function qe(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function tr(e){var t,n,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var l=e.length;for(t=0;t<l;t++)e[t]&&(n=tr(e[t]))&&(a&&(a+=" "),a+=n)}else for(n in e)e[n]&&(a&&(a+=" "),a+=n);return a}function Zr(){for(var e,t,n=0,a="",l=arguments.length;n<l;n++)(e=arguments[n])&&(t=tr(e))&&(a&&(a+=" "),a+=t);return a}function $r(e){return typeof e=="object"?Zr(e):e??""}const Lt=[...` 	
\r\f \v\uFEFF`];function Kr(e,t,n){var a=e==null?"":""+e;if(t&&(a=a?a+" "+t:t),n){for(var l in n)if(n[l])a=a?a+" "+l:l;else if(a.length)for(var u=l.length,d=0;(d=a.indexOf(l,d))>=0;){var p=d+u;(d===0||Lt.includes(a[d-1]))&&(p===a.length||Lt.includes(a[p]))?a=(d===0?"":a.substring(0,d))+a.substring(p+1):d=p}}return a===""?null:a}function Qr(e,t){return e==null?null:String(e)}function Re(e,t,n,a,l,u){var d=e.__className;if(ke||d!==n||d===void 0){var p=Kr(n,a,u);(!ke||p!==e.getAttribute("class"))&&(p==null?e.removeAttribute("class"):e.className=p),e.__className=n}else if(u&&l!==u)for(var b in u){var h=!!u[b];(l==null||h!==!!l[b])&&e.classList.toggle(b,h)}return u}function ut(e,t,n,a){var l=e.__style;if(ke||l!==t){var u=Qr(t);(!ke||u!==e.getAttribute("style"))&&(u==null?e.removeAttribute("style"):e.style.cssText=u),e.__style=t}return a}const Yr=Symbol("is custom element"),Xr=Symbol("is html");function Ct(e){if(ke){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var a=e.value;be(e,"value",null),e.value=a}if(e.hasAttribute("checked")){var l=e.checked;be(e,"checked",null),e.checked=l}}};e.__on_r=n,Er(n),zr()}}function en(e,t){var n=rr(e);n.checked!==(n.checked=t??void 0)&&(e.checked=t)}function be(e,t,n,a){var l=rr(e);if(ke&&(l[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")){rn(e,t,n??"");return}l[t]!==(l[t]=n)&&(t==="loading"&&(e[Fr]=n),n==null?e.removeAttribute(t):typeof n!="string"&&tn(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function rr(e){return e.__attributes??(e.__attributes={[Yr]:e.nodeName.includes("-"),[Xr]:e.namespaceURI===Tr})}var Pt=new Map;function tn(e){var t=Pt.get(e.nodeName);if(t)return t;Pt.set(e.nodeName,t=[]);for(var n,a=e,l=Element.prototype;l!==a;){n=kr(a);for(var u in n)n[u].set&&t.push(u);a=Ht(a)}return t}function rn(e,t,n){t==="srcset"&&nn(e,n)||wt(e.getAttribute(t)??"",n)||Rr(t,e.outerHTML.replace(e.innerHTML,e.innerHTML&&"..."),String(n))}function wt(e,t){return e===t?!0:new URL(e,document.baseURI).href===new URL(t,document.baseURI).href}function jt(e){return e.split(",").map(t=>t.trim().split(" ").filter(Boolean))}function nn(e,t){var n=jt(e.srcset),a=jt(t);return a.length===n.length&&a.every(([l,u],d)=>u===n[d][1]&&(wt(n[d][0],l)||wt(l,n[d][0])))}function Ut(e,t,n=t){var a=Ar();Yt(e,"input",l=>{e.type==="checkbox"&&Ot();var u=l?e.defaultValue:e.value;if(u=yt(e)?bt(u):u,n(u),a&&u!==(u=t())){var d=e.selectionStart,p=e.selectionEnd;e.value=u??"",p!==null&&(e.selectionStart=d,e.selectionEnd=Math.min(p,e.value.length))}}),(ke&&e.defaultValue!==e.value||Kt(t)==null&&e.value)&&n(yt(e)?bt(e.value):e.value),Or(()=>{e.type==="checkbox"&&Ot();var l=t();yt(e)&&l===bt(e.value)||e.type==="date"&&!l&&!e.value||l!==e.value&&(e.value=l??"")})}function yt(e){var t=e.type;return t==="number"||t==="range"}function bt(e){return e===""?null:+e}function nr(e,t,n){if(e.multiple)return on(e,t);for(var a of e.options){var l=st(a);if(Dr(l,t)){a.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function an(e,t){Qt(()=>{var n=new MutationObserver(()=>{var a=e.__value;nr(e,a)});return n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function sn(e,t,n=t){var a=!0;Yt(e,"change",l=>{var u=l?"[selected]":":checked",d;if(e.multiple)d=[].map.call(e.querySelectorAll(u),st);else{var p=e.querySelector(u)??e.querySelector("option:not([disabled])");d=p&&st(p)}n(d)}),Qt(()=>{var l=t();if(nr(e,l,a),a&&l===void 0){var u=e.querySelector(":checked");u!==null&&(l=st(u),n(l))}e.__value=l,a=!1}),an(e)}function on(e,t){for(var n of e.options)n.selected=~t.indexOf(st(n))}function st(e){return"__value"in e?e.__value:e.value}function De(e,...t){return Kt(()=>{try{let n=!1;const a=[];for(const l of t)l&&typeof l=="object"&&Mr in l?(a.push(Xt(l,!0)),n=!0):a.push(l);n&&(Lr(e),console.log("%c[snapshot]","color: grey",...a))}catch{}}),t}He[te]="src/lib/transferComponents/topForm.svelte";function ln(e,t,n,a){r(t).length&&(s(e.key,"ArrowDown")?(e.preventDefault(),s(r(n),null)||s(r(n),r(t).length-1)?B(n,0):dt(n)):s(e.key,"ArrowUp")?(e.preventDefault(),s(r(n),null)||s(r(n),0)?B(n,r(t).length-1):dt(n,-1)):s(e.key,"Enter")||s(e.key,"Tab")?s(r(n),null,!1)&&r(t)[r(n)]&&(a(r(t)[r(n)].projectName),e.preventDefault()):s(e.key,"Escape")&&(B(t,[],!0),B(n,null)))}function dn(e,t,n,a){r(t).length&&(s(e.key,"ArrowDown")?(e.preventDefault(),s(r(n),null)||s(r(n),r(t).length-1)?B(n,0):dt(n)):s(e.key,"ArrowUp")?(e.preventDefault(),s(r(n),null)||s(r(n),0)?B(n,r(t).length-1):dt(n,-1)):s(e.key,"Enter")||s(e.key,"Tab")?s(r(n),null,!1)&&r(t)[r(n)]&&(a(r(t)[r(n)].organizationName),e.preventDefault()):s(e.key,"Escape")&&(B(t,[],!0),B(n,null)))}var un=(e,t,n)=>t(r(n).projectName),fn=ie(le('<li role="option" style="cursor:pointer"> </li>'),He[te],[[195,5]]),cn=ie(le('<ul id="autocomplete-items-list" role="listbox"></ul>'),He[te],[[193,3]]),mn=(e,t,n)=>t(r(n).organizationName),pn=ie(le('<li role="option" style="cursor:pointer"> </li>'),He[te],[[223,5]]),hn=ie(le('<ul id="autocomplete-items-list" role="listbox"></ul>'),He[te],[[221,3]]),gn=ie(le('<form action="" autocomplete="off"><h1>Top Form</h1> <div style="position: relative;"><input type="text" placeholder="Project Name" autocomplete="off"> <!></div> <div style="position: relative;"><input type="text" placeholder="Organization Name" autocomplete="off"> <!></div></form>'),He[te],[[177,0,[[178,1],[181,1,[[182,2]]],[209,1,[[210,2]]]]]]);function He(e,t){$e(new.target),Qe(t,!0,He);let n=Ne(!1),a=Ne(""),l=Ne(Je([])),u=Ne(Je([])),d=Ne(null),p=Ne(!1),b=Ne(""),h=Ne(Je([])),g=Ne(Je([])),M=Ne(null),D=Ne(!1);Pr(async()=>{const ne=await(await fetch("/api/topFormApi")).json();B(l,ne.projects||[],!0),B(u,[],!0),B(h,ne.organizations||[],!0),B(g,[],!0)});function J(){if(!r(a)){B(u,[],!0),B(d,null);return}B(u,r(l).filter(U=>U.projectName.toLowerCase().includes(r(a).toLowerCase())),!0),B(d,r(u).length>0?0:null,!0)}function _(){if(!r(b)){B(g,[],!0),B(M,null);return}B(g,r(h).filter(U=>U.organizationName.toLowerCase().includes(r(b).toLowerCase())),!0),B(M,r(g).length>0?0:null,!0)}function y(U){B(a,U,!0),B(u,[],!0),B(n,!1)}function v(U){B(b,U,!0),B(g,[],!0),B(n,!1)}function E(){B(p,!0),J()}function H(){B(D,!0),_()}function Y(){setTimeout(()=>{B(p,!1),B(d,null)},100)}function O(){setTimeout(()=>{B(D,!1),B(M,null)},100)}function K(U){var ne;U.preventDefault(),(ne=t.addProjectName)==null||ne.call(t,r(a)),B(u,[],!0)}var fe=gn(),L=ce(X(fe),2),o=X(L);Ct(o),o.__input=J,o.__keydown=[ln,u,d,y];var i=ce(o,2);{var m=U=>{var ne=cn();xe(ne,21,()=>r(u),we,($,de,P)=>{var ae=fn();ae.__mousedown=[un,y,de];let c;var f=X(ae,!0);V(ae),pe(C=>{c=Re(ae,1,"",null,c,C),Se(f,r(de).projectName)},[()=>({selected:s(P,r(d))})]),q($,ae)}),V(ne),q(U,ne)};ge(i,U=>{r(p)&&r(u).length>0&&U(m)})}V(L);var x=ce(L,2),S=X(x);Ct(S),S.__input=_,S.__keydown=[dn,g,M,v];var w=ce(S,2);{var re=U=>{var ne=hn();xe(ne,21,()=>r(g),we,($,de,P)=>{var ae=pn();ae.__mousedown=[mn,v,de];let c;var f=X(ae,!0);V(ae),pe(C=>{c=Re(ae,1,"",null,c,C),Se(f,r(de).organizationName)},[()=>({selected:s(P,r(M))})]),q($,ae)}),V(ne),q(U,ne)};ge(w,U=>{r(D)&&r(g).length>0&&U(re)})}return V(x),V(fe),ye("submit",fe,K),ye("focus",o,E),ye("blur",o,Y),Ut(o,()=>r(a),U=>B(a,U)),ye("focus",S,H),ye("blur",S,O),Ut(S,()=>r(b),U=>B(b,U)),q(e,fe),Ye({...Ke()})}et(["input","keydown","mousedown"]);function vn(e){return e.find(t=>{var n,a,l;return((n=t.headerName)==null?void 0:n.toLowerCase().includes("land"))&&!((a=t.headerName)!=null&&a.toLowerCase().includes("holder"))&&!((l=t.headerName)!=null&&l.toLowerCase().includes("notes"))})}function Le(e,t){if(!e||!t||e.length!==t.length)return!1;const n=new Map;for(let a=0;a<e.length;a++){const l=e[a],u=t[a];l==null||l===""||(n.has(String(l))||n.set(String(l),new Set),u!=null&&u!==""&&n.get(String(l)).add(String(u)))}for(const[a,l]of n.entries())if(l.size>1)return!1;return!0}function _n(e,t){return e?Le(e,t)?"land":"planted":"both"}const Ze={REQUIRED_MATCHES:3,SAMPLE_SIZE:5,MIN_SAMPLES:2};function Nt(e,t){let n=0,a=0;for(const l of e)if(!(l==null||l==="")){if(t(l))n++;else{const u=Ze.SAMPLE_SIZE-a-1;if(n+u<Ze.REQUIRED_MATCHES)return!1}if(a++,a>=Ze.SAMPLE_SIZE)break}return a>=Ze.MIN_SAMPLES&&n>=Ze.REQUIRED_MATCHES}function yn(e,t){if(Nt(e,a=>{if(a===null||a==="")return!1;if(typeof a=="string"&&a.includes(",")){const[l,u]=a.split(",").map(d=>d.trim());return ct(l)&&mt(u)}return!1}))return"gps";const n=t.toLowerCase().trim();if(n.includes("lat")){let a=0,l=0;for(const u of e)if(!(u===null||u==="")){if(l++,typeof u=="number")u>=-90&&u<=90&&a++;else if(typeof u=="string"){const d=Number(u);!isNaN(d)&&d>=-90&&d<=90&&a++}if(l>=Ze.SAMPLE_SIZE)break}if(l>0&&a/l>=.6)return"latitude"}if(n.includes("lon")){let a=0,l=0;for(const u of e)if(!(u===null||u==="")){if(l++,typeof u=="number")u>=-180&&u<=180&&a++;else if(typeof u=="string"){const d=Number(u);!isNaN(d)&&d>=-180&&d<=180&&a++}if(l>=Ze.SAMPLE_SIZE)break}if(l>0&&a/l>=.6)return"longitude"}return Nt(e,a=>sr(a))?"date":Nt(e,a=>{if(typeof a=="number")return!0;if(typeof a=="string"){const l=a.replace(/,/g,"").trim();if(l==="")return!1;const u=Number(l);return!isNaN(u)}return!1})?"number":"string"}function ft(e){const t=e.toString();return t.includes(".")?t.split(".")[1].length>=2:!1}function ar(e){if(e==null||e==="")return!1;if(typeof e=="string"){const t=/^\s*([+-]?\d{1,3}(?:\.\d{1,})?)[\s,]*([+-]?\d{1,3}(?:\.\d{1,})?)\s*$/,n=e.match(t);if(n){const l=parseFloat(n[1]),u=parseFloat(n[2]);return ct(l)&&mt(u)}const a=e.split(/[,\s]+/).filter(l=>l.trim()!=="");if(a.length===2){const l=parseFloat(a[0]),u=parseFloat(a[1]);if(!isNaN(l)&&!isNaN(u)&&l>=-90&&l<=90&&u>=-180&&u<=180)return!0}return!1}return!1}function ct(e){if(e==null||e==="")return!1;if(typeof e=="number")return e>=-90&&e<=90&&ft(e);if(typeof e=="string"){const t=Number(e);if(!isNaN(t))return t>=-90&&t<=90&&ft(t)}return!1}function mt(e){if(e==null||e==="")return!1;if(typeof e=="number")return e>=-180&&e<=180&&ft(e);if(typeof e=="string"){const t=Number(e);if(!isNaN(t))return t>=-180&&t<=180&&ft(t)}return!1}const zt=["january","february","march","april","may","june","july","august","september","october","november","december"],Jt=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];function sr(e){if(e==null||e==="")return!1;if(typeof e=="number")return 1900<e&&e<2040;if(typeof e=="string"){if(/^\d{4}$/.test(e)){const l=parseInt(e);return 1900<l&&l<2040}const t=e.match(/^\s*([A-Za-z]{3,})\s*$/i);if(t){const l=t[1].toLowerCase();for(const u of[...zt,...Jt])if(l.startsWith(u)||u.startsWith(l))return!0}const n=e.match(/^\s*([A-Za-z]{3,})\s*[,\.]?\s*(\d{4})\s*$/i)||e.match(/^\s*(\d{4})\s*[,\.]?\s*([A-Za-z]{3,})\s*$/i);if(n){let l;isNaN(Number(n[1]))?l=n[1].toLowerCase():l=n[2].toLowerCase();for(const u of[...zt,...Jt])if(l.startsWith(u)||u.startsWith(l))return!0}return/^\d{1,2}-(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-\d{2}$/i.test(e)?!0:[/^\d{4}-\d{2}-\d{2}$/,/^\d{4}\/\d{2}\/\d{2}$/,/^\d{4}\.\d{2}\.\d{2}$/,/^\d{1,2}[\/.-]\d{1,2}[\/.-]\d{4}$/,/^\d{1,2}[\/.-]\d{1,2}[\/.-]\d{2}$/,/^(?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2},?\s+\d{4}$/i,/^\d{1,2}\s+(?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{4}$/i,/^\d{1,2}(?:st|nd|rd|th)?\s+(?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{4}$/i,/^\d{1,2}-(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-\d{4}$/i,/^\d{1,2}\s+(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{4}$/i,/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s+\d{1,2}\s+(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{4}$/i,/^\d{4}\s+(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{1,2}$/i,/^\d{4}\s+(January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2}$/i,/^(January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{4}$/i,/^(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{4}$/i,/^\d{4}-(?:Q[1-4])$/,/^\d{4}-W(?:0[1-9]|[1-4][0-9]|5[0-3])$/,/^\d{1,2}(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\d{4}$/i].some(l=>l.test(e))}return!1}function bn(e){if(typeof e=="number")return!0;if(typeof e=="string"){if(e.includes("-")&&/\d{4}-\d{2}-\d{2}/.test(e))return!1;const t=e.replace(/,/g,"").trim();if(t==="")return!1;const n=Number(t);return!isNaN(n)}return!1}function Nn(e){return e!=null}function Cn(e,t){if(!wn(t,e))return null;if(t==null||t==="")return t;switch(e){case"number":{let n;if(typeof t=="number")n=t;else{const a=t.replace(/,/g,"").trim();n=Number(a)}return isNaN(n)?t:new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:2}).format(n)}case"date":{if(typeof t=="number")return t>=1920&&t<=2040?new Date(t,0,1).toISOString():t;if(typeof t=="string"){if(/^\d{4}$/.test(t)){const d=parseInt(t);return d>=1920&&d<=2040?new Date(d,0,1).toISOString():t}let n=null;const a=t.match(/^(\d{4})[-/.](\d{1,2})[-/.](\d{1,2})$/);if(a){const d=parseInt(a[1]),p=parseInt(a[2])-1,b=parseInt(a[3]);n=new Date(d,p,b)}if(!n){const d=t.match(/^(\d{1,2})[\/.-](\d{1,2})[\/.-](\d{4})$/);if(d){const p=parseInt(d[3]),b=parseInt(d[1]),h=parseInt(d[2]);n=new Date(p,b-1,h)}}const l=["january","february","march","april","may","june","july","august","september","october","november","december"],u=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];if(!n){const d=t.match(/^(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})\s+(\d{4})$/);if(d){const p=parseInt(d[1]),b=d[2].toLowerCase(),h=parseInt(d[3]);let g=l.findIndex(M=>b.startsWith(M));g===-1&&(g=u.findIndex(M=>b.startsWith(M))),g!==-1&&(n=new Date(h,g,p))}}if(!n){const d=t.match(/^([A-Za-z]{3,})\s+(\d{1,2})(?:\,|\s)\s*(\d{4})$/);if(d){const p=d[1].toLowerCase(),b=parseInt(d[2]),h=parseInt(d[3]);let g=l.findIndex(M=>p.startsWith(M));g===-1&&(g=u.findIndex(M=>p.startsWith(M))),g!==-1&&(n=new Date(h,g,b))}}if(!n){const d=t.match(/^(\d{4})\s+([A-Za-z]{3,})\s+(\d{1,2})$/);if(d){const p=parseInt(d[1]),b=d[2].toLowerCase(),h=parseInt(d[3]);let g=l.findIndex(M=>b.startsWith(M));g===-1&&(g=u.findIndex(M=>b.startsWith(M))),g!==-1&&(n=new Date(p,g,h))}}if(!n){const d=t.match(/^(\d{1,2})[\-\s]((?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec))[\-\s](\d{4})$/i);if(d){const p=parseInt(d[1]),b=d[2].toLowerCase(),h=parseInt(d[3]),g=u.findIndex(M=>b.toLowerCase().startsWith(M));g!==-1&&(n=new Date(h,g,p))}}if(!n){const d=t.match(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s+(\d{1,2})\s+([A-Za-z]{3})\s+(\d{4})$/i);if(d){const p=parseInt(d[1]),b=d[2].toLowerCase(),h=parseInt(d[3]),g=u.findIndex(M=>b.startsWith(M));g!==-1&&(n=new Date(h,g,p))}}if(!n){const d=t.match(/^\s*([A-Za-z]{3,})\s*[,\.]?\s*(\d{4})\s*$/i)||t.match(/^\s*(\d{4})\s*[,\.]?\s*([A-Za-z]{3,})\s*$/i);if(console.log(`DEBUG DATE PARSING [FLEX_MATCH] for '${t}': ${d?"matched":"no match"}`),d){let p,b;isNaN(Number(d[1]))?(p=d[1].toLowerCase(),b=parseInt(d[2])):(b=parseInt(d[1]),p=d[2].toLowerCase()),console.log(`DEBUG DATE PARSING [EXTRACTED] for '${t}': month='${p}', year=${b}`);let h=-1;for(let g=0;g<l.length;g++)if(p.startsWith(l[g])||l[g].startsWith(p)){h=g;break}if(h===-1){for(let g=0;g<u.length;g++)if(p.startsWith(u[g])||u[g].startsWith(p)){h=g;break}}console.log(`DEBUG DATE PARSING [MONTH_NUM] for '${t}': ${h}`),h!==-1&&(n=new Date(b,h,1,0,0,0),console.log(`DEBUG DATE PARSING [CREATED_DATE] for '${t}': ${n.toISOString()}`))}}if(!n){const d=t.match(/^\s*([A-Za-z]{3,})\s*$/i);if(console.log(`DEBUG DATE PARSING [STANDALONE_MATCH] for '${t}': ${d?"matched":"no match"}`),d){const p=d[1].toLowerCase(),h=new Date().getFullYear()-1;let g=-1;for(let M=0;M<l.length;M++)if(p.startsWith(l[M])||l[M].startsWith(p)){g=M;break}if(g===-1){for(let M=0;M<u.length;M++)if(p.startsWith(u[M])||u[M].startsWith(p)){g=M;break}}console.log(`DEBUG DATE PARSING [STANDALONE_MONTH_NUM] for '${t}': ${g}`),g!==-1&&(n=new Date(h,g,1,0,0,0),console.log(`DEBUG DATE PARSING [STANDALONE_DATE] for '${t}': ${n.toISOString()}`))}}return n&&!isNaN(n.getTime())?n.toISOString():(console.log(`Date format not standardized: ${t}`),t)}return t}case"gps":case"latitude":case"longitude":{let n;if(typeof t=="number")n=t;else if(typeof t=="string"){if(e==="gps"&&t.includes(",")){const l=t.split(",").map(u=>u.trim());if(l.length===2){const u=Number(l[0]),d=Number(l[1]);if(!isNaN(u)&&!isNaN(d))return`${u.toFixed(7)},${d.toFixed(7)}`}return t}const a=t.replace(/,/g,"").trim();n=Number(a)}else return t;return isNaN(n)?t:Number(n.toFixed(7))}case"string":default:return t}}function wn(e,t){if(e==null)return!1;switch(t){case"string":return Nn(e);case"number":return bn(e);case"date":return sr(e);case"gps":return ar(e);case"latitude":return ct(e);case"longitude":return mt(e);default:return!1}}let ee=Je({columns:[]}),ve=Je({headerName:null,currentFormat:null,index:null});function xn(e){ee.columns=[],setTimeout(()=>{ee.columns=e,console.log(...De("log",`State reset: Loaded ${e.length} columns with fresh state`))},0)}function or(e,t,n){e[t].currentFormat=n,e[t].isFormatted=!0;for(let a=0;a<e[t].values.length;++a)e[t].formattedValues[a]=Cn(n,e[t].values[a]),e[t].isGreyed[a]=s(e[t].formattedValues[a],null);console.log(...De("log",`Formatted column '${e[t].headerName}' to ${n} format`))}Ge[te]="src/lib/transferComponents/FormatSelectorComponent.svelte";var Sn=ie(le("<option> </option>"),Ge[te],[[77,4]]),In=ie(le("<select></select>"),Ge[te],[[62,2]]),En=ie(le('<div class="format-selector"><!></div>'),Ge[te],[[57,0]]);function Ge(e,t){$e(new.target),Qe(t,!0,Ge),Be(t,"columnData",19,()=>[]);const n=Be(t,"currentFormat",3,"string"),a=Be(t,"currentColumnHeader",3,""),l=Be(t,"onformatchange",3,()=>{}),u=Be(t,"isTransplant",3,!1),d=Be(t,"isToggled",3,!0),p=["string","number","date","gps","latitude","longitude"];let b=Ne(Je(n())),h=Ne(!1);function g(_){B(h,!0);const v=_.target.value;console.log(...De("log","Format changed to:",v)),B(b,v,!0);const E=ee.columns.findIndex(Y=>s(Y.headerName,a()));s(E,-1,!1)&&(ee.columns[E].type=v,or(ee.columns,E,v));const H=new CustomEvent("formatchange",{detail:{destinationFormat:v,headerName:a()},bubbles:!0});l()(H)}var M=En(),D=X(M);{var J=_=>{var y=In();y.__change=g,xe(y,21,()=>p,we,(v,E)=>{var H=Sn(),Y={},O=X(H,!0);V(H),pe(()=>{Y!==(Y=r(E))&&(H.value=(H.__value=r(E))??""),Se(O,r(E))}),q(v,H)}),V(y),pe(()=>{y.disabled=u(),ut(y,`background-color: ${s(r(b),"string")?"rgba(156, 39, 176, 0.2)":s(r(b),"number")?"rgba(33, 150, 243, 0.2)":s(r(b),"date")?"rgba(255, 152, 0, 0.2)":s(r(b),"gps")?"rgba(76, 175, 80, 0.2)":"rgba(158, 158, 158, 0.2)"}`)}),sn(y,()=>r(b),v=>B(b,v)),q(_,y)};ge(D,_=>{(d()||!u())&&_(J)})}return V(M),pe(()=>ut(M,!d()&&u()?"width: 0; padding: 0; margin: 0; overflow: hidden;":"")),q(e,M),Ye({...Ke()})}et(["change"]);We[te]="src/lib/transferComponents/newTableData.svelte";var Fn=ie(le('<th><div class="column-header"><!></div> <div class="header-name"> </div></th>'),We[te],[[167,4,[[175,5],[190,5]]]]),Tn=ie(le('<div class="gps-cell"><span class="gps-coordinates"><!></span></div>'),We[te],[[203,6,[[204,7]]]]),Rn=ie(le("<td><!></td>"),We[te],[[237,5]]),kn=ie(le('<tr><td style="position: relative;"><!></td><!></tr>'),We[te],[[200,3,[[201,4]]]]),An=ie(le('<table class="data-table" style="table-layout: fixed;"><thead><tr><th class="gps-column"><div class="column-header"><span class="format-label">GPS</span></div> <div class="header-name">GPS</div></th><!></tr></thead><tbody></tbody></table>'),We[te],[[134,0,[[135,1,[[136,2,[[138,3,[[139,4,[[140,5]]],[142,4]]]]]]],[197,1]]]]);function We(e,t){$e(new.target),Qe(t,!0,We);const n=3,a=Be(t,"pageIs",3,"transfer");let l=he(()=>s(a(),"transplant"));function u(J){var Y;if(!J.dataTransfer)return;const _=J.target,y=Number(_.dataset.columnIndex),v=_.dataset.headerName??"";ve.headerName=v,ve.currentFormat=ee.columns[y].currentFormat,ve.index=y;const E=vn(ee.columns);if(E){const O=ee.columns[y],K=_n(E.values,O.values);console.log(...De("log",`Dragging column ${v} - compatibility with ${E.headerName}: ${K}`))}console.log(...De("log",ve)),document.querySelectorAll(`[data-column-index="${y}"]`).forEach(O=>O.classList.add("dragging"));const H=document.createElement("div");H.className="drag-preview",H.innerHTML=`
			<div class="preview-header">${v}</div>
			${(Y=ee.columns[y])==null?void 0:Y.values.slice(0,3).map(O=>`<div class="preview-row">${O}</div>`).join("")}
		`,document.body.appendChild(H),J.dataTransfer.setDragImage(H,0,0),J.dataTransfer.setData("text",y.toString())}function d(){var J;document.querySelectorAll(".dragging").forEach(_=>_.classList.remove("dragging")),(J=document.querySelector(".drag-preview"))==null||J.remove(),ve.headerName=null,ve.currentFormat=null,ve.index=null}function p(J){for(const v of ee.columns)if(s(v.currentFormat,"gps")&&s(v.values[J],null,!1)&&s(v.values[J],"",!1)){const E=v.values[J];if(ar(E))return{type:"full",value:E}}let _=null,y=null;for(const v of ee.columns){const E=v.values[J];s(E,null)||s(E,"")||(s(v.currentFormat,"latitude")&&!_?ct(E)&&(_=E):s(v.currentFormat,"longitude")&&!y&&mt(E)&&(y=E))}return s(_,null,!1)&&s(y,null,!1)?{type:"pair",lat:_,lon:y}:null}var b=An(),h=X(b),g=X(h),M=ce(X(g));xe(M,17,()=>ee.columns.filter(J=>r(l)?J.isToggled:!0),we,(J,_,y)=>{var v=Fn();const E=he(()=>ee.columns.find(m=>{var x;return(x=m.mappedTo)==null?void 0:x.includes("landName")}));r(E);const H=he(()=>ee.columns.find(m=>{var x;return(x=m.mappedTo)==null?void 0:x.includes("cropName")}));r(H);const Y=he(()=>{var m,x;return((m=r(_).mappedTo)==null?void 0:m.includes("landName"))||((x=r(_).mappedTo)==null?void 0:x.includes("cropName"))});r(Y);const O=he(()=>!r(_).isMapped&&!r(Y)&&r(E)?s(r(_).currentFormat,"date",!1)&&s(r(_).currentFormat,"number",!1)&&!r(_).headerName.toLowerCase().includes("ownership")&&Le(r(E).values,r(_).values):!1);r(O);const K=he(()=>!r(_).isMapped&&!r(Y)&&r(H)?s(r(_).currentFormat,"date",!1)&&s(r(_).currentFormat,"number",!1)&&!r(_).headerName.toLowerCase().includes("ownership")&&Le(r(H).values,r(_).values):!1);r(K),be(v,"data-column-index",y);var fe=X(v),L=X(fe);Ge(L,{get columnData(){return r(_).values},get currentFormat(){return r(_).currentFormat},get currentColumnHeader(){return r(_).headerName},onformatchange:m=>{const x=m.detail.destinationFormat;r(_).currentFormat=x,r(_).isFormatted=!0},get isTransplant(){return r(l)},get isToggled(){return r(_).isToggled}}),V(fe);var o=ce(fe,2),i=X(o,!0);V(o),V(v),pe(()=>{be(v,"data-header-name",r(_).headerName),be(v,"draggable",!r(_).isMapped),ut(v,`position: relative; ${r(O)?"border: 1px solid #2196f3;":""} ${r(K)?"border: 1px solid #4caf50;":""} ${r(O)&&r(K)?"border-left: 1px solid #2196f3; border-top: 1px solid #2196f3; border-right: 1px solid #4caf50; border-bottom: 1px solid #4caf50;":""}`),be(o,"id",r(_).headerName),Se(i,r(_).headerName)}),ye("dragstart",v,u),ye("dragend",v,d),q(J,v)}),V(g),V(h);var D=ce(h);return xe(D,21,()=>ee.columns[0].values.slice(0,r(l)?n:void 0),we,(J,_,y)=>{var v=kn();const E=he(()=>p(y));r(E);var H=X(v),Y=X(H);{var O=fe=>{var L=Tn(),o=X(L),i=X(o);{var m=S=>{var w=Ae();pe(()=>Se(w,r(E).value)),q(S,w)},x=(S,w)=>{{var re=U=>{var ne=Ae();pe(()=>Se(ne,`${r(E).lat??""}, ${r(E).lon??""}`)),q(U,ne)};ge(S,U=>{s(r(E).type,"pair")&&U(re)},w)}};ge(i,S=>{s(r(E).type,"full")?S(m):S(x,!1)})}V(o),V(L),q(fe,L)};ge(Y,fe=>{r(E)&&fe(O)})}V(H);var K=ce(H);xe(K,17,()=>ee.columns.filter(fe=>r(l)?fe.isToggled:!0),we,(fe,L,o)=>{var i=Rn();const m=he(()=>ee.columns.find(P=>{var ae;return(ae=P.mappedTo)==null?void 0:ae.includes("landName")}));r(m);const x=he(()=>ee.columns.find(P=>{var ae;return(ae=P.mappedTo)==null?void 0:ae.includes("cropName")}));r(x);const S=he(()=>r(m)&&s(r(L).headerName,r(m).headerName)||r(x)&&s(r(L).headerName,r(x).headerName));r(S);const w=he(()=>!r(L).isMapped&&!r(S)&&r(m)?s(r(L).currentFormat,"date",!1)&&!r(L).headerName.toLowerCase().includes("ownership")&&Le(r(m).values,r(L).values):!1);r(w);const re=he(()=>!r(L).isMapped&&!r(S)&&r(x)?s(r(L).currentFormat,"date",!1)&&s(r(L).currentFormat,"number",!1)&&!r(L).headerName.toLowerCase().includes("ownership")&&Le(r(x).values,r(L).values):!1);r(re),be(i,"data-column-index",o);let U;var ne=X(i);{var $=P=>{},de=P=>{var ae=Ae();pe(()=>Se(ae,s(r(L).formattedValues[y],null)?r(L).values[y]:r(L).formattedValues[y])),q(P,ae)};ge(ne,P=>{r(l)&&(r(L).isGreyed[y]||!r(L).isToggled)?P($):P(de,!1)})}V(i),pe(P=>{be(i,"data-header-name",r(L).headerName),be(i,"draggable",!r(L).isMapped),ut(i,`position: relative; ${r(w)?"border: 1px solid #2196f3;":""} ${r(re)?"border: 1px solid #4caf50;":""} ${r(w)&&r(re)?"border-left: 1px solid #2196f3; border-top: 1px solid #2196f3; border-right: 1px solid #4caf50; border-bottom: 1px solid #4caf50;":""}`),U=Re(i,1,"",null,U,P)},[()=>({"greyed-out":r(l)?r(L).isMapped:!(r(L).isToggled&&!r(L).isGreyed[y])})]),ye("dragstart",i,u),ye("dragend",i,d),q(fe,i)}),V(v),q(J,v)}),V(D),V(b),q(e,b),Ye({...Ke()})}function On(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lt={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var Dn=lt.exports,Vt;function Mn(){return Vt||(Vt=1,function(e,t){((n,a)=>{e.exports=a()})(Dn,function n(){var a=typeof self<"u"?self:typeof window<"u"?window:a!==void 0?a:{},l,u=!a.document&&!!a.postMessage,d=a.IS_PAPA_WORKER||!1,p={},b=0,h={};function g(o){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(i){var m=K(i);m.chunkSize=parseInt(m.chunkSize),i.step||i.chunk||(m.chunkSize=null),this._handle=new y(m),(this._handle.streamer=this)._config=m}).call(this,o),this.parseChunk=function(i,m){var x=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<x){let w=this._config.newline;w||(S=this._config.quoteChar||'"',w=this._handle.guessLineEndings(i,S)),i=[...i.split(w).slice(x)].join(w)}this.isFirstChunk&&L(this._config.beforeFirstChunk)&&(S=this._config.beforeFirstChunk(i))!==void 0&&(i=S),this.isFirstChunk=!1,this._halted=!1;var x=this._partialLine+i,S=(this._partialLine="",this._handle.parse(x,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(i=S.meta.cursor,x=(this._finished||(this._partialLine=x.substring(i-this._baseIndex),this._baseIndex=i),S&&S.data&&(this._rowCount+=S.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),d)a.postMessage({results:S,workerId:h.WORKER_ID,finished:x});else if(L(this._config.chunk)&&!m){if(this._config.chunk(S,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=S=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(S.data),this._completeResults.errors=this._completeResults.errors.concat(S.errors),this._completeResults.meta=S.meta),this._completed||!x||!L(this._config.complete)||S&&S.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),x||S&&S.meta.paused||this._nextChunk(),S}this._halted=!0},this._sendError=function(i){L(this._config.error)?this._config.error(i):d&&this._config.error&&a.postMessage({workerId:h.WORKER_ID,error:i,finished:!1})}}function M(o){var i;(o=o||{}).chunkSize||(o.chunkSize=h.RemoteChunkSize),g.call(this,o),this._nextChunk=u?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(m){this._input=m,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(i=new XMLHttpRequest,this._config.withCredentials&&(i.withCredentials=this._config.withCredentials),u||(i.onload=fe(this._chunkLoaded,this),i.onerror=fe(this._chunkError,this)),i.open(this._config.downloadRequestBody?"POST":"GET",this._input,!u),this._config.downloadRequestHeaders){var m,x=this._config.downloadRequestHeaders;for(m in x)i.setRequestHeader(m,x[m])}var S;this._config.chunkSize&&(S=this._start+this._config.chunkSize-1,i.setRequestHeader("Range","bytes="+this._start+"-"+S));try{i.send(this._config.downloadRequestBody)}catch(w){this._chunkError(w.message)}u&&i.status===0&&this._chunkError()}},this._chunkLoaded=function(){i.readyState===4&&(i.status<200||400<=i.status?this._chunkError():(this._start+=this._config.chunkSize||i.responseText.length,this._finished=!this._config.chunkSize||this._start>=(m=>(m=m.getResponseHeader("Content-Range"))!==null?parseInt(m.substring(m.lastIndexOf("/")+1)):-1)(i),this.parseChunk(i.responseText)))},this._chunkError=function(m){m=i.statusText||m,this._sendError(new Error(m))}}function D(o){(o=o||{}).chunkSize||(o.chunkSize=h.LocalChunkSize),g.call(this,o);var i,m,x=typeof FileReader<"u";this.stream=function(S){this._input=S,m=S.slice||S.webkitSlice||S.mozSlice,x?((i=new FileReader).onload=fe(this._chunkLoaded,this),i.onerror=fe(this._chunkError,this)):i=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var S=this._input,w=(this._config.chunkSize&&(w=Math.min(this._start+this._config.chunkSize,this._input.size),S=m.call(S,this._start,w)),i.readAsText(S,this._config.encoding));x||this._chunkLoaded({target:{result:w}})},this._chunkLoaded=function(S){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(S.target.result)},this._chunkError=function(){this._sendError(i.error)}}function J(o){var i;g.call(this,o=o||{}),this.stream=function(m){return i=m,this._nextChunk()},this._nextChunk=function(){var m,x;if(!this._finished)return m=this._config.chunkSize,i=m?(x=i.substring(0,m),i.substring(m)):(x=i,""),this._finished=!i,this.parseChunk(x)}}function _(o){g.call(this,o=o||{});var i=[],m=!0,x=!1;this.pause=function(){g.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){g.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(S){this._input=S,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){x&&i.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),i.length?this.parseChunk(i.shift()):m=!0},this._streamData=fe(function(S){try{i.push(typeof S=="string"?S:S.toString(this._config.encoding)),m&&(m=!1,this._checkIsFinished(),this.parseChunk(i.shift()))}catch(w){this._streamError(w)}},this),this._streamError=fe(function(S){this._streamCleanUp(),this._sendError(S)},this),this._streamEnd=fe(function(){this._streamCleanUp(),x=!0,this._streamData("")},this),this._streamCleanUp=fe(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function y(o){var i,m,x,S,w=Math.pow(2,53),re=-w,U=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ne=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,$=this,de=0,P=0,ae=!1,c=!1,f=[],C={data:[],errors:[],meta:{}};function T(A){return o.skipEmptyLines==="greedy"?A.join("").trim()==="":A.length===1&&A[0].length===0}function W(){if(C&&x&&(se("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),x=!1),o.skipEmptyLines&&(C.data=C.data.filter(function(F){return!T(F)})),j()){let F=function(N,G){L(o.transformHeader)&&(N=o.transformHeader(N,G)),f.push(N)};if(C)if(Array.isArray(C.data[0])){for(var A=0;j()&&A<C.data.length;A++)C.data[A].forEach(F);C.data.splice(0,1)}else C.data.forEach(F)}function R(F,N){for(var G=o.header?{}:[],Q=0;Q<F.length;Q++){var Z=Q,I=F[Q],I=((ue,oe)=>(k=>(o.dynamicTypingFunction&&o.dynamicTyping[k]===void 0&&(o.dynamicTyping[k]=o.dynamicTypingFunction(k)),(o.dynamicTyping[k]||o.dynamicTyping)===!0))(ue)?oe==="true"||oe==="TRUE"||oe!=="false"&&oe!=="FALSE"&&((k=>{if(U.test(k)&&(k=parseFloat(k),re<k&&k<w))return 1})(oe)?parseFloat(oe):ne.test(oe)?new Date(oe):oe===""?null:oe):oe)(Z=o.header?Q>=f.length?"__parsed_extra":f[Q]:Z,I=o.transform?o.transform(I,Z):I);Z==="__parsed_extra"?(G[Z]=G[Z]||[],G[Z].push(I)):G[Z]=I}return o.header&&(Q>f.length?se("FieldMismatch","TooManyFields","Too many fields: expected "+f.length+" fields but parsed "+Q,P+N):Q<f.length&&se("FieldMismatch","TooFewFields","Too few fields: expected "+f.length+" fields but parsed "+Q,P+N)),G}var z;C&&(o.header||o.dynamicTyping||o.transform)&&(z=1,!C.data.length||Array.isArray(C.data[0])?(C.data=C.data.map(R),z=C.data.length):C.data=R(C.data,0),o.header&&C.meta&&(C.meta.fields=f),P+=z)}function j(){return o.header&&f.length===0}function se(A,R,z,F){A={type:A,code:R,message:z},F!==void 0&&(A.row=F),C.errors.push(A)}L(o.step)&&(S=o.step,o.step=function(A){C=A,j()?W():(W(),C.data.length!==0&&(de+=A.data.length,o.preview&&de>o.preview?m.abort():(C.data=C.data[0],S(C,$))))}),this.parse=function(A,R,z){var F=o.quoteChar||'"',F=(o.newline||(o.newline=this.guessLineEndings(A,F)),x=!1,o.delimiter?L(o.delimiter)&&(o.delimiter=o.delimiter(A),C.meta.delimiter=o.delimiter):((F=((N,G,Q,Z,I)=>{var ue,oe,k,_e;I=I||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var Ee=0;Ee<I.length;Ee++){for(var Oe,Me=I[Ee],Ce=0,je=0,Ie=0,Fe=(k=void 0,new E({comments:Z,delimiter:Me,newline:G,preview:10}).parse(N)),Ve=0;Ve<Fe.data.length;Ve++)Q&&T(Fe.data[Ve])?Ie++:(Oe=Fe.data[Ve].length,je+=Oe,k===void 0?k=Oe:0<Oe&&(Ce+=Math.abs(Oe-k),k=Oe));0<Fe.data.length&&(je/=Fe.data.length-Ie),(oe===void 0||Ce<=oe)&&(_e===void 0||_e<je)&&1.99<je&&(oe=Ce,ue=Me,_e=je)}return{successful:!!(o.delimiter=ue),bestDelimiter:ue}})(A,o.newline,o.skipEmptyLines,o.comments,o.delimitersToGuess)).successful?o.delimiter=F.bestDelimiter:(x=!0,o.delimiter=h.DefaultDelimiter),C.meta.delimiter=o.delimiter),K(o));return o.preview&&o.header&&F.preview++,i=A,m=new E(F),C=m.parse(i,R,z),W(),ae?{meta:{paused:!0}}:C||{meta:{paused:!1}}},this.paused=function(){return ae},this.pause=function(){ae=!0,m.abort(),i=L(o.chunk)?"":i.substring(m.getCharIndex())},this.resume=function(){$.streamer._halted?(ae=!1,$.streamer.parseChunk(i,!0)):setTimeout($.resume,3)},this.aborted=function(){return c},this.abort=function(){c=!0,m.abort(),C.meta.aborted=!0,L(o.complete)&&o.complete(C),i=""},this.guessLineEndings=function(N,F){N=N.substring(0,1048576);var F=new RegExp(v(F)+"([^]*?)"+v(F),"gm"),z=(N=N.replace(F,"")).split("\r"),F=N.split(`
`),N=1<F.length&&F[0].length<z[0].length;if(z.length===1||N)return`
`;for(var G=0,Q=0;Q<z.length;Q++)z[Q][0]===`
`&&G++;return G>=z.length/2?`\r
`:"\r"}}function v(o){return o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function E(o){var i=(o=o||{}).delimiter,m=o.newline,x=o.comments,S=o.step,w=o.preview,re=o.fastMode,U=null,ne=!1,$=o.quoteChar==null?'"':o.quoteChar,de=$;if(o.escapeChar!==void 0&&(de=o.escapeChar),(typeof i!="string"||-1<h.BAD_DELIMITERS.indexOf(i))&&(i=","),x===i)throw new Error("Comment character same as delimiter");x===!0?x="#":(typeof x!="string"||-1<h.BAD_DELIMITERS.indexOf(x))&&(x=!1),m!==`
`&&m!=="\r"&&m!==`\r
`&&(m=`
`);var P=0,ae=!1;this.parse=function(c,f,C){if(typeof c!="string")throw new Error("Input must be a string");var T=c.length,W=i.length,j=m.length,se=x.length,A=L(S),R=[],z=[],F=[],N=P=0;if(!c)return Ce();if(re||re!==!1&&c.indexOf($)===-1){for(var G=c.split(m),Q=0;Q<G.length;Q++){if(F=G[Q],P+=F.length,Q!==G.length-1)P+=m.length;else if(C)return Ce();if(!x||F.substring(0,se)!==x){if(A){if(R=[],_e(F.split(i)),je(),ae)return Ce()}else _e(F.split(i));if(w&&w<=Q)return R=R.slice(0,w),Ce(!0)}}return Ce()}for(var Z=c.indexOf(i,P),I=c.indexOf(m,P),ue=new RegExp(v(de)+v($),"g"),oe=c.indexOf($,P);;)if(c[P]===$)for(oe=P,P++;;){if((oe=c.indexOf($,oe+1))===-1)return C||z.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:R.length,index:P}),Oe();if(oe===T-1)return Oe(c.substring(P,oe).replace(ue,$));if($===de&&c[oe+1]===de)oe++;else if($===de||oe===0||c[oe-1]!==de){Z!==-1&&Z<oe+1&&(Z=c.indexOf(i,oe+1));var k=Ee((I=I!==-1&&I<oe+1?c.indexOf(m,oe+1):I)===-1?Z:Math.min(Z,I));if(c.substr(oe+1+k,W)===i){F.push(c.substring(P,oe).replace(ue,$)),c[P=oe+1+k+W]!==$&&(oe=c.indexOf($,P)),Z=c.indexOf(i,P),I=c.indexOf(m,P);break}if(k=Ee(I),c.substring(oe+1+k,oe+1+k+j)===m){if(F.push(c.substring(P,oe).replace(ue,$)),Me(oe+1+k+j),Z=c.indexOf(i,P),oe=c.indexOf($,P),A&&(je(),ae))return Ce();if(w&&R.length>=w)return Ce(!0);break}z.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:R.length,index:P}),oe++}}else if(x&&F.length===0&&c.substring(P,P+se)===x){if(I===-1)return Ce();P=I+j,I=c.indexOf(m,P),Z=c.indexOf(i,P)}else if(Z!==-1&&(Z<I||I===-1))F.push(c.substring(P,Z)),P=Z+W,Z=c.indexOf(i,P);else{if(I===-1)break;if(F.push(c.substring(P,I)),Me(I+j),A&&(je(),ae))return Ce();if(w&&R.length>=w)return Ce(!0)}return Oe();function _e(Ie){R.push(Ie),N=P}function Ee(Ie){var Fe=0;return Fe=Ie!==-1&&(Ie=c.substring(oe+1,Ie))&&Ie.trim()===""?Ie.length:Fe}function Oe(Ie){return C||(Ie===void 0&&(Ie=c.substring(P)),F.push(Ie),P=T,_e(F),A&&je()),Ce()}function Me(Ie){P=Ie,_e(F),F=[],I=c.indexOf(m,P)}function Ce(Ie){if(o.header&&!f&&R.length&&!ne){var Fe=R[0],Ve={},ht=new Set(Fe);let It=!1;for(let Xe=0;Xe<Fe.length;Xe++){let Ue=Fe[Xe];if(Ve[Ue=L(o.transformHeader)?o.transformHeader(Ue,Xe):Ue]){let rt,Et=Ve[Ue];for(;rt=Ue+"_"+Et,Et++,ht.has(rt););ht.add(rt),Fe[Xe]=rt,Ve[Ue]++,It=!0,(U=U===null?{}:U)[rt]=Ue}else Ve[Ue]=1,Fe[Xe]=Ue;ht.add(Ue)}It&&console.warn("Duplicate headers found and renamed."),ne=!0}return{data:R,errors:z,meta:{delimiter:i,linebreak:m,aborted:ae,truncated:!!Ie,cursor:N+(f||0),renamedHeaders:U}}}function je(){S(Ce()),R=[],z=[]}},this.abort=function(){ae=!0},this.getCharIndex=function(){return P}}function H(o){var i=o.data,m=p[i.workerId],x=!1;if(i.error)m.userError(i.error,i.file);else if(i.results&&i.results.data){var S={abort:function(){x=!0,Y(i.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:O,resume:O};if(L(m.userStep)){for(var w=0;w<i.results.data.length&&(m.userStep({data:i.results.data[w],errors:i.results.errors,meta:i.results.meta},S),!x);w++);delete i.results}else L(m.userChunk)&&(m.userChunk(i.results,S,i.file),delete i.results)}i.finished&&!x&&Y(i.workerId,i.results)}function Y(o,i){var m=p[o];L(m.userComplete)&&m.userComplete(i),m.terminate(),delete p[o]}function O(){throw new Error("Not implemented.")}function K(o){if(typeof o!="object"||o===null)return o;var i,m=Array.isArray(o)?[]:{};for(i in o)m[i]=K(o[i]);return m}function fe(o,i){return function(){o.apply(i,arguments)}}function L(o){return typeof o=="function"}return h.parse=function(o,i){var m=(i=i||{}).dynamicTyping||!1;if(L(m)&&(i.dynamicTypingFunction=m,m={}),i.dynamicTyping=m,i.transform=!!L(i.transform)&&i.transform,!i.worker||!h.WORKERS_SUPPORTED)return m=null,h.NODE_STREAM_INPUT,typeof o=="string"?(o=(x=>x.charCodeAt(0)!==65279?x:x.slice(1))(o),m=new(i.download?M:J)(i)):o.readable===!0&&L(o.read)&&L(o.on)?m=new _(i):(a.File&&o instanceof File||o instanceof Object)&&(m=new D(i)),m.stream(o);(m=(()=>{var x;return!!h.WORKERS_SUPPORTED&&(x=(()=>{var S=a.URL||a.webkitURL||null,w=n.toString();return h.BLOB_URL||(h.BLOB_URL=S.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",w,")();"],{type:"text/javascript"})))})(),(x=new a.Worker(x)).onmessage=H,x.id=b++,p[x.id]=x)})()).userStep=i.step,m.userChunk=i.chunk,m.userComplete=i.complete,m.userError=i.error,i.step=L(i.step),i.chunk=L(i.chunk),i.complete=L(i.complete),i.error=L(i.error),delete i.worker,m.postMessage({input:o,config:i,workerId:m.id})},h.unparse=function(o,i){var m=!1,x=!0,S=",",w=`\r
`,re='"',U=re+re,ne=!1,$=null,de=!1,P=((()=>{if(typeof i=="object"){if(typeof i.delimiter!="string"||h.BAD_DELIMITERS.filter(function(f){return i.delimiter.indexOf(f)!==-1}).length||(S=i.delimiter),typeof i.quotes!="boolean"&&typeof i.quotes!="function"&&!Array.isArray(i.quotes)||(m=i.quotes),typeof i.skipEmptyLines!="boolean"&&typeof i.skipEmptyLines!="string"||(ne=i.skipEmptyLines),typeof i.newline=="string"&&(w=i.newline),typeof i.quoteChar=="string"&&(re=i.quoteChar),typeof i.header=="boolean"&&(x=i.header),Array.isArray(i.columns)){if(i.columns.length===0)throw new Error("Option columns is empty");$=i.columns}i.escapeChar!==void 0&&(U=i.escapeChar+re),i.escapeFormulae instanceof RegExp?de=i.escapeFormulae:typeof i.escapeFormulae=="boolean"&&i.escapeFormulae&&(de=/^[=+\-@\t\r].*$/)}})(),new RegExp(v(re),"g"));if(typeof o=="string"&&(o=JSON.parse(o)),Array.isArray(o)){if(!o.length||Array.isArray(o[0]))return ae(null,o,ne);if(typeof o[0]=="object")return ae($||Object.keys(o[0]),o,ne)}else if(typeof o=="object")return typeof o.data=="string"&&(o.data=JSON.parse(o.data)),Array.isArray(o.data)&&(o.fields||(o.fields=o.meta&&o.meta.fields||$),o.fields||(o.fields=Array.isArray(o.data[0])?o.fields:typeof o.data[0]=="object"?Object.keys(o.data[0]):[]),Array.isArray(o.data[0])||typeof o.data[0]=="object"||(o.data=[o.data])),ae(o.fields||[],o.data||[],ne);throw new Error("Unable to serialize unrecognized input");function ae(f,C,T){var W="",j=(typeof f=="string"&&(f=JSON.parse(f)),typeof C=="string"&&(C=JSON.parse(C)),Array.isArray(f)&&0<f.length),se=!Array.isArray(C[0]);if(j&&x){for(var A=0;A<f.length;A++)0<A&&(W+=S),W+=c(f[A],A);0<C.length&&(W+=w)}for(var R=0;R<C.length;R++){var z=(j?f:C[R]).length,F=!1,N=j?Object.keys(C[R]).length===0:C[R].length===0;if(T&&!j&&(F=T==="greedy"?C[R].join("").trim()==="":C[R].length===1&&C[R][0].length===0),T==="greedy"&&j){for(var G=[],Q=0;Q<z;Q++){var Z=se?f[Q]:Q;G.push(C[R][Z])}F=G.join("").trim()===""}if(!F){for(var I=0;I<z;I++){0<I&&!N&&(W+=S);var ue=j&&se?f[I]:I;W+=c(C[R][ue],I)}R<C.length-1&&(!T||0<z&&!N)&&(W+=w)}}return W}function c(f,C){var T,W;return f==null?"":f.constructor===Date?JSON.stringify(f).slice(1,25):(W=!1,de&&typeof f=="string"&&de.test(f)&&(f="'"+f,W=!0),T=f.toString().replace(P,U),(W=W||m===!0||typeof m=="function"&&m(f,C)||Array.isArray(m)&&m[C]||((j,se)=>{for(var A=0;A<se.length;A++)if(-1<j.indexOf(se[A]))return!0;return!1})(T,h.BAD_DELIMITERS)||-1<T.indexOf(S)||T.charAt(0)===" "||T.charAt(T.length-1)===" ")?re+T+re:T)}},h.RECORD_SEP="",h.UNIT_SEP="",h.BYTE_ORDER_MARK="\uFEFF",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!u&&!!a.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=E,h.ParserHandle=y,h.NetworkStreamer=M,h.FileStreamer=D,h.StringStreamer=J,h.ReadableStreamStreamer=_,a.jQuery&&((l=a.jQuery).fn.parse=function(o){var i=o.config||{},m=[];return this.each(function(w){if(!(l(this).prop("tagName").toUpperCase()==="INPUT"&&l(this).attr("type").toLowerCase()==="file"&&a.FileReader)||!this.files||this.files.length===0)return!0;for(var re=0;re<this.files.length;re++)m.push({file:this.files[re],inputElem:this,instanceConfig:l.extend({},i)})}),x(),this;function x(){if(m.length===0)L(o.complete)&&o.complete();else{var w,re,U,ne,$=m[0];if(L(o.before)){var de=o.before($.file,$.inputElem);if(typeof de=="object"){if(de.action==="abort")return w="AbortError",re=$.file,U=$.inputElem,ne=de.reason,void(L(o.error)&&o.error({name:w},re,U,ne));if(de.action==="skip")return void S();typeof de.config=="object"&&($.instanceConfig=l.extend($.instanceConfig,de.config))}else if(de==="skip")return void S()}var P=$.instanceConfig.complete;$.instanceConfig.complete=function(ae){L(P)&&P(ae,$.file,$.inputElem),S()},h.parse($.file,$.instanceConfig)}}function S(){m.splice(0,1),x()}}),d&&(a.onmessage=function(o){o=o.data,h.WORKER_ID===void 0&&o&&(h.WORKER_ID=o.workerId),typeof o.input=="string"?a.postMessage({workerId:h.WORKER_ID,results:h.parse(o.input,o.config),finished:!0}):(a.File&&o.input instanceof File||o.input instanceof Object)&&(o=h.parse(o.input,o.config))&&a.postMessage({workerId:h.WORKER_ID,results:o,finished:!0})}),(M.prototype=Object.create(g.prototype)).constructor=M,(D.prototype=Object.create(g.prototype)).constructor=D,(J.prototype=Object.create(J.prototype)).constructor=J,(_.prototype=Object.create(g.prototype)).constructor=_,h})}(lt)),lt.exports}var Ln=Mn();const Pn=On(Ln);class jn{constructor(t){this.type="string",this.currentFormat="string",this.headerName=t,this.isToggled=!0,this.isGreyed=[!1],this.isMapped=!1,this.isFormatted=!1}changeFormat(t,n="user"){this.type!==t&&(this.selectFormatCoercion={originalFormat:this.type,coercedFormat:t,timestamp:new Date,changedBy:n,userSelected:n==="user"},this.type=t,this.isFormatted=!1,this.currentFormat=t)}get wasFormatCoerced(){return!!this.selectFormatCoercion&&this.selectFormatCoercion.originalFormat!==this.selectFormatCoercion.coercedFormat}}tt[te]="src/lib/transferComponents/transferCSVImporter.svelte";async function Un(e,t,n,a,l,u){var p,b;console.log("File select event triggered");const d=e.target;if(B(t,((p=d.files)==null?void 0:p[0])??null,!0),B(n,((b=r(t))==null?void 0:b.name)||"",!0),!r(t)){console.log("No file selected"),B(a,"No file selected");return}if(s(typeof window,"undefined",!1)){const h=new CustomEvent("resetToTransferMode");window.dispatchEvent(h)}if(console.log(...De("log","Selected file:",r(t).name,r(t).type,r(t).size+" bytes")),s(r(t).type,"text/csv",!1)){console.log(...De("log","Invalid file type:",r(t).type)),B(a,"Please upload a CSV file");return}try{let g=function(M){var y;if(M.errors.length>0){B(a,M.errors.map(v=>v.message).join(", "),!0);return}const D=M.data;if(!D||s(D.length,0)){B(a,"No data found in CSV");return}const _=Object.keys(D[0]).map(v=>{const E=new jn(v),H=D.map(Y=>Y[v]);return{...E,type:"string",values:H,isGreyed:Array(H.length).fill(!1),formattedValues:Array(H.length).fill(null)}});for(let v=0;v<_.length;++v){const E=yn(_[v].values,_[v].headerName);or(_,v,E)}console.log(...De("log","Dispatching processed data:",_)),(y=u.onprocessed)==null||y.call(u,_)};console.log("Starting CSV parsing"),B(l,!0),B(a,null);const h=await new Promise((M,D)=>{Pn.parse(r(t),{header:!0,skipEmptyLines:!0,complete:M,transform:J=>J.trim(),error:D})});console.log("CSV parsing completed"),g(h)}catch(h){console.error(...De("error","CSV parsing failed:",h)),B(a,"Failed to parse CSV file")}finally{console.log("Processing complete"),B(l,!1)}}var zn=()=>{const e=document.getElementById("hidden-file-input");e&&e.click()},Jn=ie(le('<p class="error"> </p>'),tt[te],[[132,1]]),Vn=ie(le("<p>Loading...</p>"),tt[te],[[136,1]]),Gn=ie(le('<div class="file-input-container"><button>Load CSV</button> <span style="color: grey"> </span> <input id="hidden-file-input" type="file" accept=".csv" hidden></div> <!> <!>',1),tt[te],[[111,0,[[112,1],[121,1],[122,1]]]]);function tt(e,t){$e(new.target),Qe(t,!0,tt);let n=Ne(null),a=Ne(null),l=Ne(!1),u=Ne("");var d=Gn(),p=ze(d),b=X(p);b.__click=[zn];var h=ce(b,2),g=X(h,!0);V(h);var M=ce(h,2);M.__change=[Un,n,u,a,l,t],V(p);var D=ce(p,2);{var J=v=>{var E=Jn(),H=X(E,!0);V(E),pe(()=>Se(H,r(a))),q(v,E)};ge(D,v=>{r(a)&&v(J)})}var _=ce(D,2);{var y=v=>{var E=Vn();q(v,E)};ge(_,v=>{r(l)&&v(y)})}return pe(()=>{b.disabled=r(l),Se(g,r(u)),M.disabled=r(l)}),q(e,d),Ye({...Ke()})}et(["click","change"]);pt[te]="src/lib/transferComponents/ToggleComponent.svelte";function qn(e,t,n){B(t,!r(t)),n.onToggle(n.columnHeader,r(t))}var Hn=ie(le('<div class="column-toggle"><input type="checkbox"></div>'),pt[te],[[16,0,[[17,1]]]]);function pt(e,t){$e(new.target),Qe(t,!0,pt);let n=Ne(!0);var a=Hn(),l=X(a);return Ct(l),l.__change=[qn,n,t],V(a),pe(()=>en(l,r(n))),q(e,a),Ye({...Ke()})}et(["change"]);me[te]="src/lib/transferComponents/newDbTables.svelte";var Wn=ie(le('<button type="button" class="material-symbols-outlined" aria-label="Clear column">cancel</button>'),me[te],[[370,7]]),Bn=ie(le('<th><div class="column-header"><!> <!></div></th>'),me[te],[[350,4,[[359,5]]]]),Zn=ie(le("<td><!></td>"),me[te],[[386,5]]),$n=ie(le("<tr></tr>"),me[te],[[384,3]]),Kn=ie(le('<button type="button" class="material-symbols-outlined" aria-label="Clear column">cancel</button>'),me[te],[[484,7]]),Qn=ie(le('<th><div class="column-header"><!> <!></div></th>'),me[te],[[418,4,[[473,5]]]]),Yn=ie(le("<td><!></td>"),me[te],[[503,6]]),Xn=ie(le("<tr></tr>"),me[te],[[501,4]]),ea=ie(le("<td><!></td>"),me[te],[[565,6]]),ta=ie(le("<tr></tr>"),me[te],[[563,4]]),ra=ie(le('<button type="button" class="material-symbols-outlined" aria-label="Clear column">cancel</button>'),me[te],[[665,7]]),na=ie(le('<th><div class="column-header"><!> <!></div></th>'),me[te],[[599,4,[[654,5]]]]),aa=ie(le("<td><!></td>"),me[te],[[684,6]]),sa=ie(le("<tr></tr>"),me[te],[[682,4]]),oa=ie(le("<td><!></td>"),me[te],[[751,6]]),ia=ie(le("<tr></tr>"),me[te],[[749,4]]),la=ie(le('<h3 class="table-title">Planting Table</h3> <table class="no-table-bottom-margin svelte-1xthpin"><thead><tr></tr></thead><tbody></tbody></table> <h3 class="table-title">Land Table</h3> <table><thead><tr></tr></thead><tbody><!></tbody></table> <h3 class="table-title">Crop Table</h3> <table><thead><tr></tr></thead><tbody><!></tbody></table>',1),me[te],[[345,0],[346,0,[[347,1,[[348,2]]],[382,1]]],[408,0],[409,0,[[415,1,[[416,2]]],[496,1]]],[589,0],[590,0,[[596,1,[[597,2]]],[677,1]]]]);function me(e,t){$e(new.target),Qe(t,!0,me);const n=["landName","cropName","planted","plantingDate"],a=["landName","hectares","landHolder","gpsLat","gpsLon","landNotes"],l=["cropName","speciesId","seed_info","cropStock","cropNotes"];function u(c,f){const C=c[f].name,T=c[f].modelRepColumnIndex;if(c[f].values=["","",""],s(T,-1,!1)){if(ee.columns[T].isMapped=!1,ee.columns[T].mappedTo=void 0,c[f].modelRepColumnIndex=-1,s(C,"landName")){if(s(c,p)){const W=d.findIndex(j=>s(j.name,"landName"));s(W,-1,!1)&&(d[W].values=["","",""],d[W].modelRepColumnIndex=-1)}else if(s(c,d)){const W=p.findIndex(j=>s(j.name,"landName"));s(W,-1,!1)&&(p[W].values=["","",""],p[W].modelRepColumnIndex=-1)}}else if(s(C,"cropName")){if(s(c,b)){const W=d.findIndex(j=>s(j.name,"cropName"));s(W,-1,!1)&&(d[W].values=["","",""],d[W].modelRepColumnIndex=-1)}else if(s(c,d)){const W=b.findIndex(j=>s(j.name,"cropName"));s(W,-1,!1)&&(b[W].values=["","",""],b[W].modelRepColumnIndex=-1)}}}}let d=Je(h(n)),p=Je(h(a,["landName"])),b=Je(h(l,["cropName"]));function h(c,f=[]){return c.map(C=>({name:C,values:["","",""],modelRepColumnIndex:-1,viewOnly:f.includes(C)}))}qr(()=>[d]);function g(c){c.preventDefault(),c.dataTransfer&&(c.dataTransfer.dropEffect="copy")}function M(c){if(s(c,-1))return[];const f=ee.columns[c].formattedValues,C=new Map;return f.forEach((T,W)=>{s(T,null,!1)&&s(T,void 0,!1)&&s(T,"",!1)&&(C.has(T)||C.set(T,W))}),Array.from(C.values())}function D(c,f,C){var G,Q;if(c.preventDefault(),!c.dataTransfer)return;const T=Number(c.dataTransfer.getData("text")||"-1");if(T<0)return;const W=c.currentTarget;if(!W)return;const j=W.dataset.columnIndex;if(s(j,void 0))return;const se=Number(j);if(isNaN(se))return;const A=f[se].name;if(f[se].viewOnly)return;const R=ee.columns[T];if(s(f,p)&&!s(A,"landName")){const Z=((G=p.find(ue=>s(ue.name,"landName")))==null?void 0:G.modelRepColumnIndex)??-1;if(s(Z,-1))return;const I=ee.columns[Z];if(!I)return;if(!s(R.headerName,I.headerName)){if(!Le(I.values,R.values))return}}if(s(f,b)&&!s(A,"cropName")){const Z=((Q=b.find(ue=>s(ue.name,"cropName")))==null?void 0:Q.modelRepColumnIndex)??-1;if(s(Z,-1))return;const I=ee.columns[Z];if(!I)return;if(!s(R.headerName,I.headerName)){if(!Le(I.values,R.values))return}}const z=R.currentFormat,F=C[A];if(f[se].viewOnly||s(z,F,!1))return;s(f[se].modelRepColumnIndex,-1,!1)&&(ee.columns[f[se].modelRepColumnIndex].isMapped=!1,ee.columns[f[se].modelRepColumnIndex].mappedTo=void 0),f[se].modelRepColumnIndex=T,ee.columns[T].isMapped=!0;let N="";if(s(f,d)&&(N="planting."),s(f,p)&&(N="land."),s(f,b)&&(N="crop."),ee.columns[T].mappedTo=N+A,s(A,"landName")&&s(f,d)){const Z=p.findIndex(I=>s(I.name,"landName"));s(Z,-1,!1)&&(p[Z].modelRepColumnIndex=T)}else if(s(A,"cropName")&&s(f,d)){const Z=b.findIndex(I=>s(I.name,"cropName"));s(Z,-1,!1)&&(b[Z].modelRepColumnIndex=T)}else if(s(A,"landName")&&s(f,p)){const Z=d.findIndex(I=>s(I.name,"landName"));s(Z,-1,!1)&&(d[Z].modelRepColumnIndex=T)}else if(s(A,"cropName")&&s(f,b)){const Z=d.findIndex(I=>s(I.name,"cropName"));s(Z,-1,!1)&&(d[Z].modelRepColumnIndex=T)}}function J(c){D(c,d,t.plantingDbFormat)}function _(c){D(c,p,t.landDbFormat)}function y(c){D(c,b,t.cropDbFormat)}var v=la(),E=ce(ze(v),2),H=X(E),Y=X(H);xe(Y,21,()=>d,we,(c,f,C)=>{var T=Bn();be(T,"data-column-index",C);let W;var j=X(T),se=X(j);Ge(se,{columnData:[],get currentFormat(){return t.plantingDbFormat[r(f).name]},get currentColumnHeader(){return r(f).name},onformatchange:F=>{},isTransplant:!0,isToggled:!0});var A=ce(se),R=ce(A);{var z=F=>{var N=Wn();N.__click=()=>u(d,C),q(F,N)};ge(R,F=>{r(f).viewOnly||F(z)})}V(j),V(T),pe(F=>{be(T,"data-header-name",r(f).name),W=Re(T,1,"",null,W,F),Se(A,` ${r(f).name??""} `)},[()=>({"legal-droptarget":!r(f).viewOnly&&s(ve.currentFormat,t.plantingDbFormat[r(f).name])&&s(r(f).modelRepColumnIndex,-1)})]),ye("dragover",T,function(...F){Te(()=>r(f).viewOnly?null:g,this,F,me,[353,17])}),ye("drop",T,function(...F){Te(()=>r(f).viewOnly?null:J,this,F,me,[354,13])}),q(c,T)}),V(Y),V(H);var O=ce(H);xe(O,21,()=>ee.columns[0].values.slice(0,3),we,(c,f,C)=>{var T=$n();xe(T,21,()=>d,we,(W,j,se)=>{var A=Zn();be(A,"data-column-index",se);let R;var z=X(A);{var F=G=>{var Q=Ae();pe(()=>Se(Q,ee.columns[r(j).modelRepColumnIndex].formattedValues[C])),q(G,Q)},N=G=>{var Q=Ae();Q.nodeValue="",q(G,Q)};ge(z,G=>{s(r(j).modelRepColumnIndex,-1,!1)?G(F):G(N,!1)})}V(A),pe(G=>{be(A,"data-header-name",r(j).name),R=Re(A,1,"svelte-1xthpin",null,R,G)},[()=>({"legal-droptarget":!r(j).viewOnly&&s(ve.currentFormat,t.plantingDbFormat[r(j).name])&&s(r(j).modelRepColumnIndex,-1),"view-only":r(j).viewOnly})]),ye("dragover",A,function(...G){Te(()=>r(j).viewOnly?null:g,this,G,me,[389,18])}),ye("drop",A,function(...G){Te(()=>r(j).viewOnly?null:J,this,G,me,[390,14])}),q(W,A)}),V(T),q(c,T)}),V(O),V(E);var K=ce(E,4);let fe;var L=X(K),o=X(L);xe(o,21,()=>p,we,(c,f,C)=>{var T=Qn();be(T,"data-column-index",C);var W=he(()=>r(f).viewOnly||s(r(f).name,"landName",!1)&&!p.some(N=>s(N.name,"landName")&&s(N.modelRepColumnIndex,-1,!1))?null:_);let j;var se=X(T),A=X(se);Ge(A,{columnData:[],get currentFormat(){return t.landDbFormat[r(f).name]},get currentColumnHeader(){return r(f).name},onformatchange:N=>{},isTransplant:!0,isToggled:!0});var R=ce(A),z=ce(R);{var F=N=>{var G=Kn();G.__click=()=>u(p,C),q(N,G)};ge(z,N=>{!r(f).viewOnly&&(p.some(G=>s(G.name,"landName")&&s(G.modelRepColumnIndex,-1,!1))||s(r(f).name,"landName"))&&N(F)})}V(se),V(T),pe(N=>{be(T,"data-header-name",r(f).name),j=Re(T,1,"svelte-1xthpin",null,j,N),Se(R,` ${r(f).name??""} `)},[()=>({"legal-droptarget":s(r(f).name,"landName")?!r(f).viewOnly&&s(r(f).modelRepColumnIndex,-1)&&s(ve.currentFormat,t.landDbFormat[r(f).name]):!r(f).viewOnly&&p.some(N=>s(N.name,"landName")&&s(N.modelRepColumnIndex,-1,!1))&&s(ve.currentFormat,t.landDbFormat[r(f).name])&&s(r(f).modelRepColumnIndex,-1)&&(()=>{var I;if(it(ve.index,null))return!1;const N=ee.columns[ve.index],G=((I=p.find(ue=>s(ue.name,"landName")))==null?void 0:I.modelRepColumnIndex)??-1;if(s(G,-1))return!1;const Q=ee.columns[G];return Q?s(N.headerName,Q.headerName)?!0:Le(Q.values,N.values):!1})(),"view-only":r(f).viewOnly||!p.some(N=>s(N.name,"landName")&&s(N.modelRepColumnIndex,-1,!1))&&s(r(f).name,"landName",!1)})]),ye("dragover",T,g),ye("drop",T,function(...N){Te(()=>r(W),this,N,me,[422,13],!0)}),q(c,T)}),V(o),V(L);var i=ce(L),m=X(i);{var x=c=>{var f=ot();const C=he(()=>p.find(j=>s(j.name,"landName")));r(C);const T=he(()=>{var j;return M(((j=r(C))==null?void 0:j.modelRepColumnIndex)??-1)});r(T);var W=ze(f);xe(W,17,()=>r(T).slice(0,3),we,(j,se)=>{var A=Xn();xe(A,21,()=>p,we,(R,z,F)=>{var N=Yn();be(N,"data-column-index",F);var G=he(()=>r(z).viewOnly||!p.some(k=>s(k.name,"landName")&&s(k.modelRepColumnIndex,-1,!1))?null:g),Q=he(()=>r(z).viewOnly||!p.some(k=>s(k.name,"landName")&&s(k.modelRepColumnIndex,-1,!1))?null:_);let Z;var I=X(N);{var ue=k=>{var _e=Ae();pe(()=>Se(_e,ee.columns[r(z).modelRepColumnIndex].formattedValues[r(se)])),q(k,_e)},oe=k=>{var _e=Ae();_e.nodeValue="",q(k,_e)};ge(I,k=>{s(r(z).modelRepColumnIndex,-1,!1)?k(ue):k(oe,!1)})}V(N),pe(k=>{be(N,"data-header-name",r(z).name),Z=Re(N,1,"svelte-1xthpin",null,Z,k)},[()=>({"legal-droptarget":s(r(z).name,"landName")?!r(z).viewOnly&&s(r(z).modelRepColumnIndex,-1)&&s(ve.currentFormat,t.landDbFormat[r(z).name]):!r(z).viewOnly&&p.some(k=>s(k.name,"landName")&&s(k.modelRepColumnIndex,-1,!1))&&s(ve.currentFormat,t.landDbFormat[r(z).name])&&s(r(z).modelRepColumnIndex,-1)&&(()=>{var Me;if(it(ve.index,null))return!1;const k=ee.columns[ve.index],_e=((Me=p.find(Ce=>s(Ce.name,"landName")))==null?void 0:Me.modelRepColumnIndex)??-1;if(s(_e,-1))return!1;const Ee=ee.columns[_e];return Ee?s(k.headerName,Ee.headerName)?!0:Le(Ee.values,k.values):!1})(),"view-only":r(z).viewOnly||!p.some(k=>s(k.name,"landName")&&s(k.modelRepColumnIndex,-1,!1))&&s(r(z).name,"landName",!1)})]),ye("dragover",N,function(...k){Te(()=>r(G),this,k,me,[506,19])}),ye("drop",N,function(...k){Te(()=>r(Q),this,k,me,[510,15])}),q(R,N)}),V(A),q(j,A)}),q(c,f)},S=c=>{var f=ot(),C=ze(f);xe(C,17,()=>ee.columns[0].values.slice(0,3),we,(T,W,j)=>{var se=ta();xe(se,21,()=>p,we,(A,R,z)=>{var F=ea();be(F,"data-column-index",z);let N;var G=X(F);{var Q=I=>{var ue=Ae();pe(()=>Se(ue,ee.columns[r(R).modelRepColumnIndex].formattedValues[j])),q(I,ue)},Z=I=>{var ue=Ae();ue.nodeValue="",q(I,ue)};ge(G,I=>{s(r(R).modelRepColumnIndex,-1,!1)?I(Q):I(Z,!1)})}V(F),pe(I=>{be(F,"data-header-name",r(R).name),N=Re(F,1,"svelte-1xthpin",null,N,I)},[()=>({"legal-droptarget":!r(R).viewOnly&&s(r(R).name,"landName")&&s(ve.currentFormat,t.landDbFormat[r(R).name])&&s(r(R).modelRepColumnIndex,-1),"view-only":r(R).viewOnly||s(r(R).name,"landName",!1)})]),ye("dragover",F,function(...I){Te(()=>r(R).viewOnly||s(r(R).name,"landName",!1)?null:g,this,I,me,[568,19])}),ye("drop",F,function(...I){Te(()=>r(R).viewOnly||s(r(R).name,"landName",!1)?null:_,this,I,me,[569,15])}),q(A,F)}),V(se),q(T,se)}),q(c,f)};ge(m,c=>{p.some(f=>s(f.name,"landName")&&s(f.modelRepColumnIndex,-1,!1))?c(x):c(S,!1)})}V(i),V(K);var w=ce(K,4);let re;var U=X(w),ne=X(U);xe(ne,21,()=>b,we,(c,f,C)=>{var T=na();be(T,"data-column-index",C);var W=he(()=>r(f).viewOnly||s(r(f).name,"cropName",!1)&&!b.some(N=>s(N.name,"cropName")&&s(N.modelRepColumnIndex,-1,!1))?null:y);let j;var se=X(T),A=X(se);Ge(A,{columnData:[],get currentFormat(){return t.cropDbFormat[r(f).name]},get currentColumnHeader(){return r(f).name},onformatchange:N=>{},isTransplant:!0,isToggled:!0});var R=ce(A),z=ce(R);{var F=N=>{var G=ra();G.__click=()=>u(b,C),q(N,G)};ge(z,N=>{!r(f).viewOnly&&(b.some(G=>s(G.name,"cropName")&&s(G.modelRepColumnIndex,-1,!1))||s(r(f).name,"cropName"))&&N(F)})}V(se),V(T),pe(N=>{be(T,"data-header-name",r(f).name),j=Re(T,1,"svelte-1xthpin",null,j,N),Se(R,` ${r(f).name??""} `)},[()=>({"legal-droptarget":s(r(f).name,"cropName")?!r(f).viewOnly&&s(r(f).modelRepColumnIndex,-1)&&s(ve.currentFormat,t.cropDbFormat[r(f).name]):!r(f).viewOnly&&b.some(N=>s(N.name,"cropName")&&s(N.modelRepColumnIndex,-1,!1))&&s(ve.currentFormat,t.cropDbFormat[r(f).name])&&s(r(f).modelRepColumnIndex,-1)&&(()=>{var I;if(it(ve.index,null))return!1;const N=ee.columns[ve.index],G=((I=b.find(ue=>s(ue.name,"cropName")))==null?void 0:I.modelRepColumnIndex)??-1;if(s(G,-1))return!1;const Q=ee.columns[G];return Q?s(N.headerName,Q.headerName)?!0:Le(Q.values,N.values):!1})(),"view-only":r(f).viewOnly||!b.some(N=>s(N.name,"cropName")&&s(N.modelRepColumnIndex,-1,!1))&&s(r(f).name,"cropName",!1)})]),ye("dragover",T,g),ye("drop",T,function(...N){Te(()=>r(W),this,N,me,[603,13],!0)}),q(c,T)}),V(ne),V(U);var $=ce(U),de=X($);{var P=c=>{var f=ot();const C=he(()=>b.find(j=>s(j.name,"cropName")));r(C);const T=he(()=>{var j;return M(((j=r(C))==null?void 0:j.modelRepColumnIndex)??-1)});r(T);var W=ze(f);xe(W,17,()=>r(T).slice(0,3),we,(j,se)=>{var A=sa();xe(A,21,()=>b,we,(R,z,F)=>{var N=aa();be(N,"data-column-index",F);var G=he(()=>r(z).viewOnly||!b.some(k=>s(k.name,"cropName")&&s(k.modelRepColumnIndex,-1,!1))?null:g),Q=he(()=>r(z).viewOnly||!b.some(k=>s(k.name,"cropName")&&s(k.modelRepColumnIndex,-1,!1))?null:y);let Z;var I=X(N);{var ue=k=>{var _e=Ae();pe(()=>Se(_e,ee.columns[r(z).modelRepColumnIndex].formattedValues[r(se)])),q(k,_e)},oe=k=>{var _e=Ae();_e.nodeValue="",q(k,_e)};ge(I,k=>{s(r(z).modelRepColumnIndex,-1,!1)?k(ue):k(oe,!1)})}V(N),pe(k=>{be(N,"data-header-name",r(z).name),Z=Re(N,1,"svelte-1xthpin",null,Z,k)},[()=>({"legal-droptarget":s(r(z).name,"cropName")?!r(z).viewOnly&&s(r(z).modelRepColumnIndex,-1)&&s(ve.currentFormat,t.cropDbFormat[r(z).name]):!r(z).viewOnly&&b.some(k=>s(k.name,"cropName")&&s(k.modelRepColumnIndex,-1,!1))&&s(ve.currentFormat,t.cropDbFormat[r(z).name])&&s(r(z).modelRepColumnIndex,-1)&&(()=>{var Me;if(it(ve.index,null))return!1;const k=ee.columns[ve.index],_e=((Me=b.find(Ce=>s(Ce.name,"cropName")))==null?void 0:Me.modelRepColumnIndex)??-1;if(s(_e,-1))return!1;const Ee=ee.columns[_e];return Ee?s(k.headerName,Ee.headerName)?!0:Le(Ee.values,k.values):!1})(),"view-only":r(z).viewOnly||!b.some(k=>s(k.name,"cropName")&&s(k.modelRepColumnIndex,-1,!1))&&s(r(z).name,"cropName",!1)})]),ye("dragover",N,function(...k){Te(()=>r(G),this,k,me,[687,19])}),ye("drop",N,function(...k){Te(()=>r(Q),this,k,me,[691,15])}),q(R,N)}),V(A),q(j,A)}),q(c,f)},ae=c=>{var f=ot(),C=ze(f);xe(C,17,()=>ee.columns[0].values.slice(0,3),we,(T,W,j)=>{var se=ia();xe(se,21,()=>b,we,(A,R,z)=>{var F=oa();be(F,"data-column-index",z);let N;var G=X(F);{var Q=I=>{var ue=Ae();pe(()=>Se(ue,ee.columns[r(R).modelRepColumnIndex].formattedValues[j])),q(I,ue)},Z=I=>{var ue=Ae();ue.nodeValue="",q(I,ue)};ge(G,I=>{s(r(R).modelRepColumnIndex,-1,!1)?I(Q):I(Z,!1)})}V(F),pe(I=>{be(F,"data-header-name",r(R).name),N=Re(F,1,"svelte-1xthpin",null,N,I)},[()=>({"legal-droptarget":s(r(R).name,"cropName")&&!r(R).viewOnly&&s(ve.currentFormat,t.cropDbFormat[r(R).name])&&s(r(R).modelRepColumnIndex,-1),"view-only":r(R).viewOnly||s(r(R).name,"cropName",!1)})]),ye("dragover",F,function(...I){Te(()=>r(R).viewOnly||s(r(R).name,"cropName",!1)?null:g,this,I,me,[754,19])}),ye("drop",F,function(...I){Te(()=>r(R).viewOnly||s(r(R).name,"cropName",!1)?null:y,this,I,me,[755,15])}),q(A,F)}),V(se),q(T,se)}),q(c,f)};ge(de,c=>{b.some(f=>s(f.name,"cropName")&&s(f.modelRepColumnIndex,-1,!1))?c(P):c(ae,!1)})}return V($),V(w),pe((c,f)=>{fe=Re(K,1,"no-table-bottom-margin land-table svelte-1xthpin",null,fe,c),re=Re(w,1,"no-table-bottom-margin crop-table svelte-1xthpin",null,re,f)},[()=>({"greyed-out":!p.some(c=>s(c.name,"landName")&&s(c.modelRepColumnIndex,-1,!1))}),()=>({"greyed-out":!b.some(c=>s(c.name,"cropName")&&s(c.modelRepColumnIndex,-1,!1))})]),q(e,v),Ye({...Ke()})}et(["click"]);async function da(){try{const e=ee.columns;if(!e||e.length===0)return console.error("No data available to submit"),{success:!1,error:"No data available to submit"};const t=e.filter(y=>y.isMapped&&y.mappedTo),n=t.filter(y=>{var v;return(v=y.mappedTo)==null?void 0:v.startsWith("land.")}),a=t.filter(y=>{var v;return(v=y.mappedTo)==null?void 0:v.startsWith("crop.")}),l=t.filter(y=>{var v;return(v=y.mappedTo)==null?void 0:v.startsWith("planting.")});console.log("landColumns:"),n.forEach(y=>console.log("  land col.mappedTo:",y.mappedTo)),console.log("plantingColumns:"),l.forEach(y=>console.log("  planting col.mappedTo:",y.mappedTo));const u=t.find(y=>y.mappedTo==="land.landName"||y.mappedTo==="planting.landName"),d=t.find(y=>y.mappedTo==="crop.cropName"||y.mappedTo==="planting.cropName");console.log("DEBUG: Found landNameColumn:",u),console.log("DEBUG: Found cropNameColumn:",d);const p=new Set,b=new Set;u&&u.values.forEach(y=>{y&&p.add(y)}),d&&d.values.forEach(y=>{y&&b.add(y)});const h=Array.from(p).map(y=>{const v={landName:y};return n.forEach(E=>{var H;if(E.mappedTo!=="land.landName"){const Y=((H=E.mappedTo)==null?void 0:H.replace("land.",""))||"",O=u==null?void 0:u.values.findIndex((K,fe)=>K===y&&!u.isGreyed[fe]);O!==void 0&&O>=0&&O<E.values.length&&(E.isGreyed[O]||(v[Y]=E.formattedValues[O]??E.values[O]))}}),v}),g=Array.from(b).map(y=>{const v={cropName:y};return a.forEach(E=>{var H;if(E.mappedTo!=="crop.cropName"){const Y=((H=E.mappedTo)==null?void 0:H.replace("crop.",""))||"",O=d==null?void 0:d.values.findIndex((K,fe)=>K===y&&!d.isGreyed[fe]);O!==void 0&&O>=0&&O<E.values.length&&(E.isGreyed[O]||(v[Y]=E.formattedValues[O]??E.values[O]))}}),v}),M=[];if(u&&d)for(let y=0;y<u.values.length;y++){const v=u.values[y],E=d.values[y];if(!v||!E||u.isGreyed[y]||d.isGreyed[y])continue;const H={landName:v,cropName:E};l.forEach(Y=>{var O;if(Y.mappedTo!=="planting.landName"&&Y.mappedTo!=="planting.cropName"){const K=((O=Y.mappedTo)==null?void 0:O.replace("planting.",""))||"";y<Y.values.length&&!Y.isGreyed[y]&&(H[K]=Y.formattedValues[y]??Y.values[y])}}),M.push(H)}const D={projectName:"TransPlant Import "+new Date().toISOString().split("T")[0],projectNotes:"Imported via TransPlant application",land:h,crops:g,plantings:M};console.log("Submitting data to Server:",D);const J=await fetch("/api/submitToDb",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}),_=await J.json();if(!J.ok)throw new Error(_.error||"Unknown error");return console.log("Server submission result:",_),{success:!0,result:_}}catch(e){return console.error("Failed to submit to Server:",e),{success:!1,error:e.message}}}Pe[te]="src/routes/transfer/+page.svelte";function ua(e,t){const n=JSON.stringify(ee.columns.map(a=>({headerName:a.headerName,type:a.type,currentFormat:a.currentFormat,isToggled:a.isToggled,isGreyed:a.isGreyed.slice(0,3),formattedValues:a.formattedValues.slice(0,3),isMapped:a.isMapped,mappedTo:a.mappedTo,isFormatted:a.isFormatted,selectFormatCoercion:a.selectFormatCoercion,wasFormatCoerced:a.wasFormatCoerced,values:a.values.slice(0,3)})),null,2);navigator.clipboard.writeText(n).then(async()=>{B(t,!0),await Ur(),setTimeout(()=>B(t,!1),1200)})}function Gt(e,t){s(r(t),"transplant")?B(t,"transfer"):B(t,"transplant"),console.log(...De("log","Page view changed to:",r(t)))}var fa=ie(le("<button>Send to TransPlant</button>"),Pe[te],[[114,3]]),ca=async(e,t,n)=>{B(t,!0),B(n,null),B(n,await da(),!0),B(t,!1)},ma=ie(le('<span class="spinner svelte-mj4yc2"></span>'),Pe[te],[[127,5]]),pa=ie(le("<div> </div>"),Pe[te],[[133,4]]),ha=ie(le("<button><!> Submit to DB</button> <button>Back to Transfer</button> <!>",1),Pe[te],[[117,3],[131,3]]),ga=ie(le('<div class="toggle-row"><div class="column-toggle" style="visibility: hidden;"></div> <!></div>'),Pe[te],[[148,4,[[150,5]]]]),va=ie(le('<div class="table-container"><div class="table-header"><!></div> <!></div> <!>',1),Pe[te],[[144,1,[[145,2]]]]),_a=ie(le('<span style="color: green; font-size: 0.9rem; margin-left: 0.5rem;">Copied!</span>'),Pe[te],[[190,2]]),ya=ie(le('<div style="display: flex; align-items: center; gap: 0.5rem;"><button aria-label="Copy column model JSON" style="background: none; border: none; cursor: pointer; padding: 0; font-size: 1.2rem;" title="Copy JSON to clipboard">📋</button> <h2 style="margin: 0;">Current Column Model State</h2> <!></div> <pre> </pre>',1),Pe[te],[[179,1,[[180,1],[188,1]]],[193,1]]),ba=ie(le('<!> <div style="display: flex; align-items: flex-start; gap: 0.5rem; margin-bottom: 0.2rem;"><div><!></div> <div style="display: flex; align-items: center; gap: 0.5rem; margin-left: auto;"><!> <!></div></div> <!> <!>',1),Pe[te],[[108,0,[[109,1],[112,1]]]]);function Pe(e,t){$e(new.target),Qe(t,!0,Pe);const n=w=>{console.log(...De("log","projectName",w))};let a=Ne(!1),l=Ne(!1),u=Ne(null);const d=he(()=>{var w;return((w=t.data)==null?void 0:w.landsDbTable)||[]}),p=he(()=>{var w;return((w=t.data)==null?void 0:w.plantingDbTable)||[]}),b=he(()=>{var w;return((w=t.data)==null?void 0:w.cropDbTable)||[]}),h=he(()=>{var w;return((w=t.data)==null?void 0:w.landDbFormat)||"string"}),g=he(()=>{var w;return((w=t.data)==null?void 0:w.plantingDbFormat)||"string"}),M=he(()=>{var w;return((w=t.data)==null?void 0:w.cropDbFormat)||"string"});let D=Ne("transfer");function J(w){xn(w||[])}function _(w,re){const U=re.detail.destinationFormat;console.log(...De("log",`Called from format event from table: ${U}`)),w.currentFormat=U,w.isFormatted=!0}s(typeof window,"undefined",!1)&&window.addEventListener("resetToTransferMode",()=>{s(r(D),"transplant")&&(B(D,"transfer"),console.log("Reset to transfer mode from CSV import"))});var y=ba(),v=ze(y);He(v,{addProjectName:n});var E=ce(v,2),H=X(E),Y=X(H);tt(Y,{onprocessed:J}),V(H);var O=ce(H,2),K=X(O);{var fe=w=>{var re=fa();re.__click=[Gt,D],q(w,re)};ge(K,w=>{s(r(D),"transfer")&&w(fe)})}var L=ce(K,2);{var o=w=>{var re=ha(),U=ze(re);U.__click=[ca,l,u];var ne=X(U);{var $=c=>{var f=ma();q(c,f)};ge(ne,c=>{r(l)&&c($)})}jr(),V(U);var de=ce(U,2);de.__click=[Gt,D];var P=ce(de,2);{var ae=c=>{var f=pa(),C=X(f,!0);V(f),pe(()=>{Re(f,1,$r(r(u).success?"success-message":"error-message"),"svelte-mj4yc2"),Se(C,r(u).success?"Success!":r(u).error)}),q(c,f)};ge(P,c=>{r(u)&&c(ae)})}pe(()=>U.disabled=r(l)),q(w,re)};ge(L,w=>{s(r(D),"transplant")&&w(o)})}V(O),V(E);var i=ce(E,2);{var m=w=>{var re=va(),U=ze(re),ne=X(U),$=X(ne);{var de=f=>{var C=ga(),T=ce(X(C),2);xe(T,17,()=>ee.columns,we,(W,j,se)=>{pt(W,{get columnHeader(){return r(j).headerName},onToggle:(A,R)=>r(j).isToggled=R})}),V(C),q(f,C)};ge($,f=>{s(r(D),"transfer")&&f(de)})}V(ne);var P=ce(ne,2);We(P,{get pageIs(){return r(D)}}),V(U);var ae=ce(U,2);{var c=f=>{me(f,{get landUserTable(){return r(d)},get plantingUserTable(){return r(p)},get cropUserTable(){return r(b)},get landDbFormat(){return r(h)},get plantingDbFormat(){return r(g)},get cropDbFormat(){return r(M)}})};ge(ae,f=>{s(r(D),"transplant")&&f(c)})}q(w,re)};ge(i,w=>{ee.columns.length>0&&w(m)})}var x=ce(i,2);{var S=w=>{var re=ya(),U=ze(re),ne=X(U);ne.__click=[ua,a];var $=ce(ne,4);{var de=c=>{var f=_a();q(c,f)};ge($,c=>{r(a)&&c(de)})}V(U);var P=ce(U,2),ae=X(P);V(P),pe(c=>Se(ae,`		${c??""}
	`),[()=>JSON.stringify(ee.columns.map(c=>({headerName:c.headerName,type:c.type,currentFormat:c.currentFormat,isToggled:c.isToggled,isGreyed:c.isGreyed.slice(0,3),formattedValues:c.formattedValues.slice(0,3),isMapped:c.isMapped,mappedTo:c.mappedTo,isFormatted:c.isFormatted,selectFormatCoercion:c.selectFormatCoercion,wasFormatCoerced:c.wasFormatCoerced})),null,2)]),q(w,re)};ge(x,w=>{ee.columns&&w(S)})}return q(e,y),Ye({get formatEvent(){return _},...Ke()})}et(["click"]);export{Pe as component};
